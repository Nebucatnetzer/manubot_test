<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Andreas Zweili" />
  <meta name="dcterms.date" content="2019-12-17" />
  <meta name="keywords" content="markdown, publishing, manubot" />
  <title>Manuscript Title</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <!--
  Manubot generated metadata rendered from header-includes-template.html.
  Suggest improvements at https://github.com/manubot/manubot/blob/master/manubot/process/header-includes-template.html
  -->
  <meta name="dc.format" content="text/html" />
  <meta name="dc.title" content="Manuscript Title" />
  <meta name="citation_title" content="Manuscript Title" />
  <meta property="og:title" content="Manuscript Title" />
  <meta property="twitter:title" content="Manuscript Title" />
  <meta name="dc.date" content="2019-12-17" />
  <meta name="citation_publication_date" content="2019-12-17" />
  <meta name="dc.language" content="en-US" />
  <meta name="citation_language" content="en-US" />
  <meta name="dc.relation.ispartof" content="Manubot" />
  <meta name="dc.publisher" content="Manubot" />
  <meta name="citation_journal_title" content="Manubot" />
  <meta name="citation_technical_report_institution" content="Manubot" />
  <meta name="citation_author" content="Andreas Zweili" />
  <meta name="citation_author_institution" content="Contria GmbH" />
  <meta name="citation_author_orcid" content="XXXX-XXXX-XXXX-XXXX" />
  <meta name="twitter:creator" content="@-" />
  <link rel="canonical" href="https://Nebucatnetzer.github.io/manubot_test/" />
  <meta property="og:url" content="https://Nebucatnetzer.github.io/manubot_test/" />
  <meta property="twitter:url" content="https://Nebucatnetzer.github.io/manubot_test/" />
  <meta name="citation_fulltext_html_url" content="https://Nebucatnetzer.github.io/manubot_test/" />
  <meta name="citation_pdf_url" content="https://Nebucatnetzer.github.io/manubot_test/manuscript.pdf" />
  <link rel="alternate" type="application/pdf" href="https://Nebucatnetzer.github.io/manubot_test/manuscript.pdf" /> <link rel="alternate" type="text/html" href="https://Nebucatnetzer.github.io/manubot_test/v/14235b00585b5a9b7977d70e75c6e0874eee8545/" />
  <meta name="manubot_html_url_versioned" content="https://Nebucatnetzer.github.io/manubot_test/v/14235b00585b5a9b7977d70e75c6e0874eee8545/" />
  <meta name="manubot_pdf_url_versioned" content="https://Nebucatnetzer.github.io/manubot_test/v/14235b00585b5a9b7977d70e75c6e0874eee8545/manuscript.pdf" />
  <meta property="og:type" content="article" />
  <meta property="twitter:card" content="summary_large_image" />
  <link rel="icon" type="image/png" sizes="192x192" href="https://manubot.org/favicon-192x192.png" /> <link rel="mask-icon" href="https://manubot.org/safari-pinned-tab.svg" color="#ad1457" />
  <meta name="theme-color" content="#ad1457" />
  <!-- end Manubot generated metadata -->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Manuscript Title</h1>
</header>
<p><small><em> This manuscript (<a href="https://Nebucatnetzer.github.io/manubot_test/v/14235b00585b5a9b7977d70e75c6e0874eee8545/">permalink</a>) was automatically generated from <a href="https://github.com/Nebucatnetzer/manubot_test/tree/14235b00585b5a9b7977d70e75c6e0874eee8545">Nebucatnetzer/manubot_test@14235b0</a> on December 17, 2019. </em></small></p>
<h2 id="authors">Authors</h2>
<ul>
<li><strong>Andreas Zweili</strong><br> <img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" /> <a href="https://orcid.org/XXXX-XXXX-XXXX-XXXX">XXXX-XXXX-XXXX-XXXX</a> · <img src="images/github.svg" class="inline_icon" alt="GitHub icon" /> <a href="https://github.com/Nebucatnetzer">Nebucatnetzer</a> · <img src="images/twitter.svg" class="inline_icon" alt="Twitter icon" /> <a href="https://twitter.com/-">-</a><br> <small> Contria GmbH · Funded by - </small></li>
</ul>
<h2 id="abstract" class="page_break_before">Abstract</h2>
<h1 id="über-dieses-dokument">1 Über dieses Dokument</h1>
<h2 id="beschreibung">1.1 Beschreibung</h2>
<p>Diese Arbeit hat zum Ziel, die Planung und Erstellung einer grafischen Oberfläche zum einfachen Bedienen der Software borg [borgbackup], durchzuführen sowie zu dokumentieren.</p>
<h2 id="zweck-und-inhalt">1.2 Zweck und Inhalt</h2>
<p>Zweck dieses Dokumentes ist die vollständige und nachvollziehbare Dokumentation zur Diplomarbeit von Andreas Zweili.</p>
<h2 id="aufbau">1.3 Aufbau</h2>
<p>Inhalte sind in der Regel chronologisch sortiert, vom ältesten zum jüngsten Ereignis, und nach Kapiteln getrennt. An gewissen Stellen kann die chronologische Reihenfolge allenfalls nicht gewährleistet werden.</p>
<h2 id="lizenz">1.4 Lizenz</h2>
<p>Dieses Dokument wurde von Andreas Zweili im Rahmen der Diplomarbeit an der IBZ Schule erstellt und steht unter der cc BY-SA 4.0 [cc] Lizenz. Dadurch darf die Arbeit unter Beibehalten der Lizenz kopiert und weiterverarbeitet werden. Zusätzlich muss der Urheber genannt werden.</p>
<h1 id="initialisierung">2 Initialisierung</h1>
<h2 id="vision">2.1 Vision</h2>
<p>Die Software soll borg für den durchschnittlichen Computer User zugänglich machen. Backups sollen dabei schnell und unkompliziert erstellt werden können. Auch die Möglichkeit automatischer im Hintergrund laufender Backups soll dem User gegeben sein, damit die Hürde für Backups so tief wie möglich gehalten wird.</p>
<p>Die besten Backups sind solche, bei denen man gar nicht mehr weiss, dass man sie hat bis man sie braucht.</p>
<h2 id="ausgangslage">2.2 Ausgangslage</h2>
<p>borg ist deshalb interessant, weil es während einem Backup relativ wenig Ressource im Vergleich zu anderen Systemen benötigt und schon relativ lange aktiv entwickelt wird. Dadurch ist es im Alltag geprüft worden. Des Weiteren bietet borg die Funktion für Verschlüsselung, was es einem User ermöglicht die Daten auf einem unsicheren Cloud Speicher abzulegen.</p>
<p>Des Weiteren speichert borg die Daten mit Block basierter dedup ab. Dies hat den riesigen Vorteil, dass bei einem Backup nur die Änderungen auf Block-Ebene gespeichert werden und nicht jedes Mal die ganze Datei kopiert werden muss.</p>
<p>Damit ermöglicht die Software auch Backups von sehr grossen Dateien, wie Videos oder Disk Images von virtuellen Maschinen, in mehreren Versionen. Ohne dabei jedoch signifikant mehr an Speicher zu benötigen. Zusätzlich werden die Backups dadurch rasend schnell ausgeführt. Gerade dieses Feature macht borg in den Augen des Autors besonders interessant, da sich der durchschnittliche User möglichst wenig mit Dingen wie Backups auseinandersetzen möchte. Umso besser also, wenn sie schnell gehen und so wenig Speicherplatz wie möglich verbrauchen.</p>
<p>borg wird jedoch komplett über die Kommandozeile bedient. Somit ist es für normale Benutzer eher schwierig den Zugang zu der Software zu finden, geschweige denn sie zu bedienen.</p>
<p>borg bietet Entwicklern eine json, api, mit welcher sie, von borg ausgegebenen Dateien einfach weiterverarbeiten können.</p>
<p>borg steht unter einer bsd [bsd] Lizenz zur Verfügung und ist somit gemäss den Richtlinien der Free Software Foundation libre [fsflicenses].</p>
<p>Das Projekt muss dabei vom Studenten in Eigenarbeit und einer Zeit von 250 Stunden bis zum 18. März 2019 erarbeitet werden.</p>
<h2 id="projektziele">2.3 Projektziele</h2>
<p>borg ist eine Kommandozeilen basierte Backup Software. Hauptziel dieser Arbeit ist, ein gui für die Software borg zu entwickeln um die Nutzung zu vereinfachen. Da borg selber freie Software ist und mit freier Software viel gute Erfahrungen gemacht wurden, soll das Projekt selber auch wieder libre sein. Zum einen, um der Community etwas zurückzugeben, des weiteren, um anderen Entwicklern die Möglichkeit zu geben die Software zu verbessern und weiter zu entwickeln.</p>
<p>Als Nebenziel soll mit dieser Arbeit auch die Verbreitung von freier Software gefördert werden. Dies wird insbesondere dadurch erreicht, dass die Software selbst unter der gpl Version 3 [gplv3] veröffentlicht wird. Wenn möglich soll während der Entwicklung auch hauptsächlich freie Software verwendet werden, um aufzuzeigen das ein solches Projekte nicht zwingend von proprietärer Software abhängig ist. Die gesamte Arbeit wird zudem zu jedem Zeitpunkt öffentlich einsehbar sein. Der Quelltext der Dokumentation ist unter diesem Link erreichbar: <a href="https://git.2li.ch/Nebucatnetzer/thesis" class="uri">https://git.2li.ch/Nebucatnetzer/thesis</a></p>
<p>Die Entwicklung wird hauptsächlich auf einem Linux System stattfinden. Da borg einerseits hauptsächlich auf Unix Systeme ausgelegt ist und anderseits die Hauptzielgruppe des Projektes auch auf Linux Usern liegt. Trotzdem sollen im Projekt cross-plattform fähige Technologien eingesetzt werden, damit es in der Zukunft möglich ist das Projekt auf andere Plattformen auszuweiten.</p>
<h3 id="ziele-inklusive-gewichtung">2.3.1 Ziele inklusive Gewichtung</h3>
<p>Im Projektantrag wurden vorgängig folgende Ziele definiert und entsprechend gewichtet. Die Gewichtung wurde dabei so vorgenommen, dass Ziele mit einer Muss-Gewichtung den Minimalanforderungen der zu entwickelnden Software entsprechen. Die weiteren Ziele wurden von 5 bis 1 gewichtet. Die Bewertung 5 bedeutet, dass die Umsetzung sehr nützlich und oder wichtig für die Software ist und daher in naher Zukunft zu implementieren ist. Ein Ziel mit einer tiefen Bewertung sollte, wenn möglich, auch einmal in die Software integriert werden und ist nicht unwichtig.</p>
<h2 id="projektabgrenzung">2.4 Projektabgrenzung</h2>
<p>Die Anwendung beschränkt sich darauf Funktionen von borg grafisch darzustellen oder nützlich zu erweitern, soweit dies über die api möglich ist. Wie in Abbildung:(1) zu sehen ist, werden die Aktionen effektiv immer vom Borg Binary ausgeführt und nicht von der grafischen Oberfläche. Eine Erweiterung von borg ist nicht vorgesehen. Dies aus dem Grund das Backups, Deduplikation und Verschlüsselung sowie deren korrekte Implementation komplexe Themen sind und unbedingt nur von Experten angegangen werden sollten. Die Auswirkungen von Fehlern sind sind schlicht zu gross.</p>
<p>Des Weiteren wird die Grundlage für eine kollaborative Entwicklung geschaffen. Während der Laufzeit der Diplomarbeit werden jedoch keine Inputs aus der Borg Community im Bezug auf die Entwicklung entgegengenommen.</p>
<p>Bugs von borg welche während der Dauer der Diplomarbeit vom Studenten entdeckt werden, wird dieser dem Projekt melden, jedoch nicht selber beheben.</p>
<p><a href="file:pictures/kontextdiagramm.pdf" class="uri">file:pictures/kontextdiagramm.pdf</a></p>
<h2 id="projektmethode">2.5 Projektmethode</h2>
<p>Für das Projekt wurde die wasserfall gewählt. Da nur eine einzige Person am Projekt arbeitet, kann nur ein Task nach dem anderen abgearbeitet werden und viele Aufgaben stehen in Abhängigkeit zueinander. Somit macht das iterative Vorgehen der wasserfall für dieses Projekt am meisten Sinn.</p>
<h2 id="konfigurationsmanagement">2.6 Konfigurationsmanagement</h2>
<h3 id="versionskontrolle">2.6.1 Versionskontrolle</h3>
<p>Die komplette Dokumentation, der Quellcode der Applikation sowie jegliche zusätzlichen Dokumente, wie etwa die Zeitplanung, werden mittels der Software git versioniert. Thematisch zusammengehörende Änderungen werden in einem commit zusammengefasst. Somit ist jederzeit nachvollziehbar, was wann geändert hat. Ein commit sollte dabei gemäss dem Artikel von Chris Beams „How to write a Git commit Message“ [commit] und in englischer Sprache geschrieben sein.</p>
<p>Versionsnummern sind für die Applikation zum jetzigen Zeitpunkt noch nicht vorgesehen. Sollten sie zukünftig einmal verwendet werden, soll eine semantische Versionierung [semver] verwendet werden. Dabei ist eine Versionsnummer immer nach diesem Schema aufgebaut, MAJOR.MINOR.PATCH. Bei Änderungen wird die: 1. MAJOR Version erhöht, wenn man inkompatible Änderungen an der api macht. 2. MINOR Version erhöht, wenn man Funktionalität hinzufügt, die abwärtskompatibel ist. 3. PATCH Version erhöht, wenn man abwärtskompatibel Bug-Fixes hinzufügt. Eine Versionsnummer würde dann so aussehen Version 1.2.3.</p>
<p>Auf jeden Fall sollte, sofern möglich, immer nur lauffähiger Code im Master Branch eingecheckt sein, damit der Master Branch immer eine funktionierende Software repräsentiert. Dies gilt auch für das Repository der Dokumentation. Der Master Branch der Dokumentation sollte maximal mit zwei Befehlen <code>make clean</code> und <code>make</code> „kompilierbar“ sein.</p>
<p>Als Software für die Versionskontrolle wurde git [git] aus den folgenden Gründen ausgewählt:</p>
<ul>
<li>Ist der de facto Standard bei Versionskontrollsoftware</li>
<li>Läuft auf allen gängigen Betriebssystemen</li>
<li>Es gibt gratis Services, die man nutzen kann (Github, Gitlab)</li>
<li>Ermöglicht es offline zu arbeiten und commit erstellen</li>
<li>Es steht bereits ein eigener git Server zur Verfügung</li>
<li>git ist aus vorhergehenden Projekten vertraut, dadurch muss kein Aufwand betrieben werden, eine neue Software zu lernen. Zusätzlich hat sich git in den vorhergehenden Projekten als robuste und schnelle Software erwiesen.</li>
<li>git ist libre unter der gpl v2.</li>
</ul>
<h2 id="editor">2.6.2 Editor</h2>
<p>Sowohl bei der Dokumentation wie auch bei der Programmierung wurde hauptsächlich der Editor GNU Emacs [emacs] verwendet. GNU Emacs ist mit 32 Jahren (seine Wurzeln reichen bis ins Jahre 1976 zurück) wohl eines der ältesten noch aktiven Software Projekte. Emacs ist libre unter der gpl v3. Emacs wurde gewählt, da es ein schneller, schlanker und sehr flexibler Texteditor ist. Von normaler Textmanipulation über Taskmanagement bis zu Emails schreiben ist alles möglich.</p>
<h3 id="dokumentation">2.6.3 Dokumentation</h3>
<p>Diese Dokumentation wurde in Org-mode [orgmode], einer Erweiterung für den Text Editor Emacs, geschrieben. Die Syntax von Org-mode erinnert an Markdown. Org-mode bietet einem eine Vielzahl an Hilfen, inklusive dem Erstellen von Tabellen und Spreadsheet Funktionen. Für die finale Version des Dokuments kann Org-mode die ursprünglich Textdatei über LaTeX in eine PDF Datei exportieren.</p>
<p>LaTeX [latex] ist eine Software, welche einem die Benutzung des Textsatzsystems TeXs vereinfacht. LaTeX wurde gegenüber einem „What You See Is What You Get“ (z.Bsp. MS. Word) Editor gewählt, weil es einem mit seiner Markup Sprache erlaubt das Dokument in Textdateien zu erstellen, gerade für Programmierer ist dies eine sehr interessante Lösung. Dadurch, dass LaTeX auch nur aus reinen Textdateien besteht, können die Dokumente auch ohne weiteres in die Versionskontrollsoftware einchecken und die Entwicklung im Log zurückverfolgen. LaTeX ist libre unter der LaTeX Project Public License.</p>
<p>Die Grafiken in diesem Dokument wurden hauptsächlich mit dem Vektor Grafik Editor Inkscape [inkscape] erstellt. Inkscape ist libre unter der GNU Public License v3.</p>
<p>Die Diagramme wurden mit Draw.io [draw] erstellt. Draw.io ist libre unter Apache Lizenz Version 2.0 [apache] und kann sowohl als Desktop Applikation wie auch als Webanwendung genutzt werden.</p>
<p>Beim Design der Arbeit wurden soweit als möglich die typographischen Regeln aus dem Buch „Practical Typography“ von Matthew Butterick [typo] angewandt. Bei den Diagrammen wurden ausschliesslich Farben aus der von Google entwickelten Design Sprache „Material“ [material] eingesetzt.</p>
<h2 id="zeitplanung">2.7 Zeitplanung</h2>
<p>Die detaillierte Zeitplanung ist dem Ganttchart in der Datei [02_Zeitplanung_Andreas_Zweili.html] zu entnehmen. Bei der Zeitplanung wurde darauf geachtet, dass die Arbeit soweit als möglich nicht mit dem Berufsleben kollidiert. An einem normalen Arbeitstag wurde dabei damit gerechnet das ca. 2 Stunden Arbeit am Abend möglich sein sollten. An einem arbeitsfreien Tag wurde mit 6 Stunden Arbeit gerechnet. Über die Festtage wurden diverse Tage von der Planung ausgenommen, da es nicht realistisch schien, dass an diesen Tagen die Arbeit signifikant vorwärts gehen würde. Auch Schultage wurde nicht als Arbeitstage gerechnet.</p>
<p>Um die Arbeitslast zu verteilen, wurde vom 14. Januar bis zum 11. März auf der Arbeitsstelle jeder Montag als frei eingegeben. Dadurch steht während des Projektes etwas mehr Zeit zur Verfügung, als mit einer 100 Prozent Arbeitsstelle möglich wäre.</p>
<p>[02_Zeitplanung_Andreas_Zweili.html] <a href="file:02_Zeitplanung_Andreas_Zweili.html" class="uri">file:02_Zeitplanung_Andreas_Zweili.html</a></p>
<h2 id="controlling">2.8 Controlling</h2>
<p>Mit dem Controlling wird die Planung mit den effektiv verwendeten Ressourcen verglichen und ausgewertet. Somit können für zukünftige Projekte Lehren gezogen werden.</p>
<h3 id="zeitaufwand">2.8.1 Zeitaufwand</h3>
<p>Um den geschätzten Zeitaufwand mit dem effektiv geleisteten Aufwand zu vergleichen wurde die Tabelle:(28) erstellt. Darin werden die beiden Aufwände einander gegenübergestellt und grössere Abweichungen begründet. Die Nummer vor jeder Aufgabe in der Tabelle korreliert dabei mit den Aufgabennummern im Ganttchart.</p>
<h3 id="ressourcen">2.8.2 Ressourcen</h3>
<p>In der Tabelle:(26) wurden die für die Arbeit benötigten Materialen erfasst. Da es sich beim Projekt um ein reines Software Projekt handelt ist der Material Aufwand entsprechend gering. Im Abschluss des Projektes werden die geplanten Ressourcen den effektiv verwendeten gegenübergestellt.</p>
<h3 id="kosten">2.8.3 Kosten</h3>
<p>Werden die internen Lohnkosten des Projektleiters auf ca. 60 CHF pro Stunde geschätzt (dies entspricht in etwa dem doppelten reelen Stundenlohn des Projektleiters), ergeben sich gemäss der Berechnung in der Tabelle:(27), theoretische Kosten von 19080 CHF für die Umsetzung dieser Arbeit. Die Kosten für die Entwicklung werden im Projekt jedoch nicht berücksichtigt. Somit sind diese nur ein rein theoretischer Faktor.</p>
<h2 id="projektrisiken">2.9 Projektrisiken</h2>
<p>Das Risikomanagement dient dazu Risiken im Projekt zu erkennen und Massnahmen zur Vermeidung zu definieren. Dadurch steht man Risiken nicht unvorbereitet gegenüber, sollten sie eintreffen.</p>
<h3 id="risikobeschreibung">2.9.1 Risikobeschreibung</h3>
<p>In der Tabelle: (6) sind die Risiken des Projektes gemeinsam mit ihren Gegenmassnahmen aufgelistet. Somit können gewisse Risiken bereits vorher vermieden werden.</p>
<h1 id="analyse">3 Analyse</h1>
<h2 id="swot-analyse">3.1 SWOT-Analyse</h2>
<p>Die SWOT-Analyse ist eine Methode die Stärken, Schwächen, Chancen und Gefahren zu erkennen, indem eine 4-Felder-Matrix ausgefüllt wird.</p>
<p>Grundlage einer guten SWOT Analyse ist eine klare Zieldefinition und Fragestellung.. Die ausgefüllte SWOT-Analyse für dieses Projekt ist in der Abbildung:(2) zu sehen.</p>
<p><a href="file:pictures/swot_analyse.pdf" class="uri">file:pictures/swot_analyse.pdf</a></p>
<h2 id="umweltanalyse">3.2 Umweltanalyse</h2>
<p>Die Projektumwelt-Analyse ist eine Methode die Beziehungen, Erwartungshaltungen und Einflüsse auf das Projekt durch interne und externe soziale Umwelt zu betrachten und zu bewerten. Auf Grundlage der Analyseergebnisse werden erforderliche Massnahmen zur Gestaltung der Umweltbeziehungen abgeleitet. Die Gestaltung der Projektumweltbeziehungen ist eine Projektmanagementaufgabe. In der Tabelle:(3) wurden die Anforderungen und Wünsche mit Einschätzung der Wahrscheinlichkeit und der Einflussnahme aufgenommen. Zusätzlich ist die Beziehung der Stakeholder zum Projekt noch in der Abbildung:(3) grafisch dargestellt.</p>
<p>Da das Projekt so ausgelegt ist, dass der Projektleiter es in Eigenarbeit verwirklichen kann, ist der Einfluss der Stakeholder während der Umsetzung sehr gering. Die User werden bei der Entwicklung mittels einer Usability-Studie miteinbezogen und die borg Community wird mit regelmässigen Posts auf dem offiziellen Github Repository auf dem Laufenden gehalten. Nach Ende der Diplomarbeit soll das Projekt für interessierte Entwickler jedoch offen sein. Der Quellcode wird bereits während der Arbeit öffentlich zur Verfügung gestellt.</p>
<p><a href="file:pictures/stakeholder_diagramm.pdf" class="uri">file:pictures/stakeholder_diagramm.pdf</a></p>
<h2 id="risiko-analyse">3.3 Risiko-Analyse</h2>
<p>Bei der Risiko-Analyse wird von einem durchschnittlichen Benutzer ausgegangen, der zur Zeit noch keine Backups macht und beginnen möchte borg zu nutzen, um auf einer externen Harddisk seine Backups zu speichern.</p>
<p>Es wird eine Ist/Soll Analyse gemacht. Jedes Risiko wurde entsprechend der Tabelle: (4) nach der Wahrscheinlichkeit des Eintreffens bewertet und entsprechend der Tabelle: (5) nach seiner Auswirkung im Bezug auf die Nützlichkeit der gemachten Backups.</p>
<p>In der Tabelle: (6) sind dabei die Risiken für das Szenario aufgelistet und nummeriert. In der Abbildung:(4) ist die Bewertung des Ist-Risikos grafisch dargestellt und in der Abbildung:(5) ist das Soll-Risiko, welches mit dieser Arbeit angestrebt wird, ebenfalls grafisch dargestellt.</p>
<p>Es sollte im Rahmen der Arbeit möglich sein die meisten Risiken zu verringern. Da automatische Hintergrundbackups jedoch ein Kann-Ziel sind wir in dieser Analyse nicht davon ausgegangen, dass man das Risiko Nr. 5 im Rahmen dieser Arbeit reduzieren kann.</p>
<p><a href="file:pictures/istrisiko.pdf" class="uri">file:pictures/istrisiko.pdf</a></p>
<p><a href="file:pictures/sollrisiko.pdf" class="uri">file:pictures/sollrisiko.pdf</a></p>
<h2 id="anforderungskatalog">3.4 Anforderungskatalog</h2>
<p>Der Anforderungskatalog entspricht 1:1 den Zielen, welche in der Tabelle 1 definiert wurden. Im Zeitplan wurde der Fokus hauptsächlich auf die Muss-Ziele gelegt. Ein paar der Kann-Ziele sind im Konzept jedoch auch abgebildet.</p>
<h2 id="use-cases">3.5 Use Cases</h2>
<p>Ein Use Case sammelt alle möglichen Szenarien, die eintreten können, wenn ein Akteur versucht, mithilfe des betrachteten Systems ein bestimmtes Ziel zu erreichen. Dabei beschreibt er, was beim Versuch der Zielerreichung passieren kann. Je nach Ablauf kann auch ein Fehlschlag ein Ergebnis eines Anwendungsfalls sein (e.g. falsches Passwort beim Login). Dabei wird die technische Lösung nicht konkret beschrieben. Die Detailstufe kann dabei sehr unterschiedlich sein.[usecase]</p>
<h3 id="anwendungsfalldiagramm">3.5.1 Anwendungsfalldiagramm</h3>
<p>„Ein Anwendungsfalldiagramm … ist eine der 14 Diagrammarten der Unified Modelling Language (UML), einer Sprache für die Modellierung der Strukturen und des Verhaltens von Software- und anderen Systemen. Es stellt Anwendungsfälle und Akteure mit ihren jeweiligen Abhängigkeiten und Beziehungen dar.“</p>
<p>Das Anwendungsfalldiagramm für das borg gui ist in der Abbildung: (6) zu sehen.</p>
<p><a href="file:pictures/use_case.pdf" class="uri">file:pictures/use_case.pdf</a></p>
<h3 id="use-cases-detailbeschreibung">3.5.2 Use Cases Detailbeschreibung</h3>
<p>Use Cases werden in der Regel mithilfe einer sogenannten Use Case Schablone im Detail beschrieben, damit klar ist, wie der Ablauf jeweils genau aussieht. Die in diesem Projekt verwendete Schablone wurde von Alistair Cockburn definiert.</p>
<p>Die nachfolgend aufgeführten Use Cases, Tabellen:(7, 8, 9, 10, 11, 12, 13) wurden dem Anwendungsfalldiagramm, Abbildung:(6), entnommen und zusätzlich noch um jeweils ein Aktivitätsdiagramm, Abbildungen: (7, 8, 9, 10, 11, 12), erweitert um den Ablauf verständlicher zu machen.</p>
<p>Ein Aktivitätsdiagramm ist dabei ein hilfreiches UML Diagramm zum Erweitern von Use Cases und zeigt einem gut die Zuständigkeiten der Aktoren auf.</p>
<h2 id="benötigte-funktionalität-von-borg">3.6 Benötigte Funktionalität von Borg</h2>
<p>Damit nachvollziehbar ist welche Funktionen von borg verwendet wurden um die Use Cases umsetzen zu können, werden diese hier in Beziehung zur jeweiligen Funktion des gui aufgelistet: * Für das Erstellen von Archiven <code>borg create</code> [borgcreate]. * Für das Anzeigen der Archiven <code>borg list</code> [borginfo]. * Für das Wiederherstellen der Archive <code>borg extract</code> [borgextract]. * Für das Löschen der Archive <code>borg delete</code> [borgdelete]. * Zum Mounten der Archive <code>borg mount</code> [borgmount]. * Zum Unmounten der Archive <code>borg umount</code> [borgumount]. * Zum anzeigen der Repository Statistik ~borg info~[borginfo].</p>
<p>Die detaillierte Implementation wird in der Sektion [Realisierung] beschrieben.</p>
<p>[Realisierung] siehe Abschnitt 5</p>
<h1 id="konzept">4 Konzept</h1>
<h2 id="varianten">4.1 Varianten</h2>
<p>Mit der json api von borg stehen einem diverse Möglichkeiten zur Verfügung, um das Programm anzubinden. Da das Ziel ist, das Programm normalen Nutzern zugänglicher zu machen, bietet sich ein normales Desktop Programm am ehesten an. Desktop Programme werden von allen Computer Usern täglich genutzt und sind somit etwas was sie kennen. Zudem ist es für die User auch viel einfacher zu verstehen, als wenn sie vor der Nutzung einen lokalen Webserver starten und diesen im Anschluss zur Nutzung wieder beenden müssten.</p>
<h3 id="bewertung">4.1.1 Bewertung</h3>
<p>Mit der Idee aus der „Einleitung zu den Varianten“ wurde dann eine Tabelle, mit Anforderungen an die Technologien, erstellt. Die Bewertungspunkte setzen sich einerseits aus Projektzielen anderseits aus für das Projekt sinnvollen Punkten zusammen. Dadurch ergeben sich dann die Bewertungen, welche in der Tabelle:(14) aufgenommen wurden. Die möglichen Varianten wurden danach bewertet. Die effektive Berechnung des Resultats wird nach folgender Formel durchgeführt.</p>
<p><span class="math display">\[\begin{equation}
G * EP = KE
\end{equation}\]</span></p>
<p>Also die Gewichtung(/G/) multipliziert mit der erreichten Punktzahl(/EP/) ergibt das Kriteriumsergebnis(/KE/). Für das Endresultat wird dann die Summe über alle Kriterien gebildet. Die Variante mit der höchsten Summe wurde für das Projekt ausgewählt.</p>
<p>Mussziele erhalten dabei eine Gewichtung von 10 und Wunschziele eine Gewichtung entsprechend der Bewertung in der Tabelle Projektziele (1).</p>
<h3 id="backend">4.1.2 Backend</h3>
<p>Für die Backend Programmierung bieten sich die folgende drei Sprachen an: [C#], [C++] und [Python]. Dies vor allem, weil alle drei Allrounder Sprachen sind und sich gut für Desktop Applikationen eignen.</p>
<p>[C#] siehe Abschnitt 4.1.2.1</p>
<p>[C++] siehe Abschnitt 4.1.2.2</p>
<p>[Python] siehe Abschnitt 4.1.2.3</p>
<h4 id="c">4.1.2.1 C#</h4>
<p>C# ist eine von Microsoft entwickelte Programmiersprache, welche viele Frameworks zur Verfügung stellt. Insbesondere aufgrund der grossen kommerziellen Nutzung und der guten Integration mit Microsoft Windows hat C# eine relative grosse Verbreitung. Bei Linux und OS X ist es jedoch schwieriger C# zu integrieren und zu nutzen da es nicht standardmässig installiert ist und der Fokus von C# hauptsächlich auf Microsoft Windows liegt.</p>
<p>Sie ist zu Teilen libre. Die Common Language Runtime, welche für das Ausführen von Software zuständig ist, ist unter der MIT Lizenz lizenziert [csharp], der aktuelle Compiler Roslyn ist unter der Apache Lizenz verfügbar [roslyn]. Da es sehr viele offizielle Teile um die Sprache C# gibt, kann im Rahmen des Projektes nicht direkt abgeschätzt werden, ob alle benötigten Teile libre sind. Für die Bewertung wird deshalb ein kleinerer Wert als bei C++ und Python genommen.</p>
<p>C# ist die Programmiersprache, welche an der IBZ hauptsächlich gelehrt wird. Dadurch sind die Kenntnisse der Sprache und ihrer Anwendung bereits vorhanden. Ausserhalb der Schule wurde die Sprache jedoch noch nie eingesetzt.</p>
<p>Entwickelt wird C# hauptsächlich mit der ide Microsoft Visual Studio. Dies ist eine sehr umfangreiche und komplexe Software. Visual Studio ist dabei nur für Windows und OS X erhältlich. Es ist auch möglich C# Projekte ausserhalb von Visual Studio zu erstellen, dies ist jedoch nicht sehr einfach.</p>
<p>Der Code ist gut lesbar und es gibt offizielle Styleguides von Microsoft was den Code über Projekte hinaus einheitlich aussehen lässt. Zudem hilft hier auch Visual Studio stark den Code entsprechend zu formatieren. Besonders angenehm sind die Klassen- und Methodennamen der offiziellen Frameworks. Insgesamt sehr gut gelöst aber in Sachen Lesbarkeit noch etwas hinter Python.</p>
<p>Unter Windows ist das Setup von C# relativ einfach. Allerdings ist es auch dort im Vergleich zu Python eine umfangreiche Angelegenheit Visual Studio sauber zu installieren und nutzbar zu machen. Auf anderen Plattform wird dies leider nicht einfacher und unter Linux ist es bereits schwierig eine funktionierende Umgebung in Gang zu bringen.</p>
<p>Da C# bereits an der IBZ gelehrt wird, ist der Lernfaktor hier, im Vergleich zu den anderen Sprachen, sicher am kleinsten. Allerdings gibt es noch keinerlei Kenntnisse beim Einbinden eines der unten aufgeführten gui Frameworks. Daher gibt es auf jeden Fall noch genügend zu lernen.</p>
<p>Die borg Community hat vor relativ kurzer Zeit die offizielle Unterstützung von Windows zurückgezogen. Da C# eine sehr Windows lastige Sprache ist, wird daher davon ausgegangen, dass die Sprache innerhalb der borg Community nicht sehr verbreitet ist.</p>
<p>C# ist eine stark typisiert Sprache und kompilierte Sprache. Des Weiteren ist Visual Studio der Erfahrung nach nicht die schnellste Software. Dies alles führt dazu das C# nicht gerade die schnellste Sprache zum Programmieren ist. Jedoch aufgrund des moderneren Unterbaus ist sie sicher schneller als C++.</p>
<h4 id="c-1">4.1.2.2 C++</h4>
<p>C++ ist eine stark typisierte und kompilierte Programmiersprache. Sie ist seit 1998 Teil des ISO Standards [cpp98]. ISO/IEC 14882:2017 [cpp17] ist zurzeit die aktuellste Variante. Die Sprache existiert seit ca. 33 Jahren und hat eine weitreichende Verbreitung gefunden. C++ ist auf allen Betriebssystemen gut unterstützt muss jedoch für jedes System separat kompiliert werden.</p>
<p>Von C++ sind innerhalb des Projektes keinerlei Vorkenntnisse vorhanden. Dies ist ein sehr hoher Risikofaktor.</p>
<p>C++ kompiliert direkt zu Maschinensprache und ist dadurch sehr performant und läuft sehr gut auf jedem System. C++ ist im Vergleich zu modernen Sprachen jedoch relativ komplex und bietet diverse Stolpersteine für Programmierer.</p>
<p>Zum Entwickeln braucht es verhältnismässig wenig Werkzeuge. Da die Sprache bereits sehr alt ist, stammt sie noch aus einer Zeit, wo man noch etwas rudimentärer programmierte. Allerdings braucht man in jedem Fall einen compiler, um ein Programm zu erzeugen. Bei komplexeren Programmen wird man, um mindestens so etwas wie makefile auch nicht herumkommen</p>
<p>Im Vergleich zu Python oder C# ist C++ wohl die am schwersten lesbare Sprache. Zudem gibt es auch keinen zentralen Styleguide, welcher einem vorgeben würde wie der Code am besten ausschauen sollte. Somit haben sich über die Jahre mehrere Standards etabliert.</p>
<p>Der Lernfaktor wäre aufgrund der mangelnden Vorkenntnisse hier ganz klar am Grössten.</p>
<p>Da C++ eine alte Sprache ist, geniesst sie auch eine dementsprechende Verbreitung. Daher ist anzunehmens dass sicher mindestens ein grösserer Teil der älteren borg Entwickler C++ oder C gelernt haben.</p>
<p>Da C++ auch heute noch zu den meistgenutzten Sprachen gehört, gibt es entsprechend viele Ressourcen dazu und Beispielprojekte, von denen man ableiten kann. Auch hilfreiche Libraries gibt es sehr viele, welche den Programmierer unterstützen können. Die Sprache selber ist jedoch eher umständlich zu schreiben. Hinzu kommt noch, dass man, während der Entwicklung immer wieder den Code kompilieren muss. In einem Projekt mit dieser begrenzten Zeitspanne eher ungeeignet.</p>
<h4 id="python">4.1.2.3 Python</h4>
<p>Der Python Interpreter ist für eine Vielzahl an Betriebssystemen erhältlich, inklusive Windows, OS X und Linux. Nahezu jedes Desktop Linux System kommt mit Python vor installiert. Auch OS X kommt bereits ab Werk mit Python Version 2. Version 3 lässt sich sehr einfach nachinstallieren und ist einfach nutzbar. Unter Windows gestaltetet sich die Installation etwas aufwendiger aber auch nicht sehr kompliziert. Python integriert sich in Windows jedoch etwas weniger elegant als C#.</p>
<p>Python ist freie Software unter der Python Software Foundation License [python] und wird durch die Python Software Foundation in einem Community basierten Modell entwickelt.</p>
<p>Die Vorkenntnisse sind im Vergleich zu C++ relativ gross und zu C# etwas weniger ausgeprägt. Es wurden damit im Rahmen der Ausbildung schon ein grösseres Projekt realisiert und ansonsten mehrere kleine Projekte im Privaten erstellen.</p>
<p>Für Python gibt es ein paar ide welchen den Programmierer bei seiner Arbeit unterstützen können. Keine davon ist allerdings ein Muss, um Python programmieren zu können. Im einfachsten Fall wäre dies mit Notepad möglich. Ein Editor mit etwas fortgeschritteneren Features wäre jedoch empfehlenswert.</p>
<p>Python unterstützt mehrere Programmierungsparadigmen wie etwa objektorientiert, funktionale oder prozedurale Paradigmen. Bei der Entwicklung von Python wurde sehr grossen Wert auf die Lesbarkeit der Sprache gelegt. Dies mit dem Hintergedanken das eine Programmiersprache viel häufiger gelesen als effektiv geschrieben wird [pep8].</p>
<p>Um ein Python Programm zu starten, braucht es eigentlich kein grosses Setup. Solange die Abhängigkeiten vorhanden sind, kann man ein Skript mit einem einfachen Befehl, Code Snippet (1) starten.</p>
<p>python3 example.py</p>
<p>Programmlisting 1 Minimal Python Setup</p>
<p>Da Python schon eine etwas bekanntere Sprache ist, ist der Lernfaktor der Sprache selber nicht mehr so hoch. Allerdings gibt es noch viele interessante Konzepte, die man im Zusammenhang mit der Sprache lernen kann. Wie etwa zum Beispiel multiple Vererbung von Klassen.</p>
<p>borg selber wurde in Python geschrieben. Daher ist davon auszugehen, dass Python innerhalb dieser Community eine sehr hohe Verbreitung geniesst.</p>
<p>Python ist eine dynamisch typisierte und interpretierte Sprache. Dies bedeutet, dass man bei Variablen nicht explizit den Typ angeben muss und die Programme zur Laufzeit für den Computer übersetzt werden. Interpretierte Sprachen haben den Vorteil, dass man mit ihnen in der Regel sehr schnell und unkompliziert entwickeln kann, dies jedoch zulasten der Performance.</p>
<h3 id="frontend">4.1.3 Frontend</h3>
<p>Fürs Frontend sind folgende Projekte interessant: [Qt], [Gtk] und [Electron]. Alle drei sind cross-plattform fähige gui Frameworks und nicht von einer spezifischen Sprache abhängig. Da nahezu keine Erfahrung mit den aufgeführten Frameworks vorhanden ist, werden bei den Frontend Frameworks die Punkte der Verbreitung in der Community und Geschwindigkeit der Entwicklung ausgeschlossen. In beiden Fällen wäre nicht mal eine ungenaue Schätzung wirklich möglich.</p>
<p>[Qt] siehe Abschnitt 4.1.3.1</p>
<p>[Gtk] siehe Abschnitt 4.1.3.2</p>
<p>[Electron] siehe Abschnitt 4.1.3.3</p>
<h4 id="qt">4.1.3.1 Qt</h4>
<p>Qt [qt], „cute“ ausgesprochen, ist ein Framework zum Entwickeln von grafischen Oberflächen, welche auf verschiedenen Systemen ohne grosse Änderungen laufen sollen und sich dabei soweit als möglich wie eine native Applikation verhalten und „anfühlen“ soll.</p>
<p>Die Rechte an Qt hält die Firma „The Qt Company“. Das Framework Qt wird jedoch offen entwickelt und die Community hat ein Mitspracherecht. Die Linux desktopumgebung KDE nutzt das Qt Framework intensiv. Qt ist libre und der gpl v3 [qtlicense] oder mit einer kostenpflichtigen proprietären Lizenz erhältlich, falls die gpl nicht genutzt werden kann.</p>
<p>Vorkenntnisse zu Qt sind nur sehr wenig vorhanden. Mehr als ein paar Tests wurden damit noch nicht gemacht.</p>
<p>Eine Qt Oberfläche kann direkt in der jeweiligen Sprache des Backends geschrieben werden oder Mittels des Qt Designers als xml Datei gespeichert und dann in die eigentliche Applikation importiert werden. Somit ist keine spezielle Software nötig.</p>
<p>xml ist nicht übermässig gut lesbar, allerdings kann man Qt in der verwendeten Sprache programmiert werden, somit ist es hauptsächlich von der Sprache im Backend abhängig. Die Dokumentation ist in C++ geschrieben, was für einen Entwickler ohne C++ Kenntnisse die Software etwas unzugänglich macht.</p>
<p>Qt scheint, soweit dies bis jetzt abgeschätzt werden kann, sehr leicht in ein Projekt integrierbar zu sein.</p>
<p>Da noch sehr wenig Kenntnisse vorhanden sind, ist der Lernfaktor entsprechend gross.</p>
<h4 id="gtk">4.1.3.2 Gtk</h4>
<p>Gtk ist sowohl für Linux wie auch für Windows und OS X erhältlich. Gtk hat als Projekt der Gnome Foundation seine Wurzeln jedoch ganz klar in der Linux Welt. Gtk ist libre unter der Lesser General Public Lizenz [gtklicense]. Gtk ist ein Projekt der GNOME Foundation einer nicht für Profit Organisation, welche die Entwicklung diverser freier Software Projekte koordiniert.</p>
<p>Zu Gtk gibt es keinerlei Vorkenntnisse als Programmierer. Gtk wurde bis jetzt nur intensiv als User verwendet.</p>
<p>Gtk integriert sich nur unter Linux wirklich gut ins System. Unter Windows und OS X können die Applikationen schnell etwas fremd wirken. Dies ist gut bei der Applikation Meld [meld] zu sehen, wenn man eine Datei auswählen möchte, Abbildung (13).</p>
<p><a href="file:pictures/meld.png" class="uri">file:pictures/meld.png</a> Die Gtk Dokumentation empfiehlt [gtk_setup], dass man unter Microsoft Windows das Programm MSYS2 installiert, um Gtk einzurichten. Zum Programmieren an sich braucht es nicht zwingend weitere Tools aus einem Editor. Wie auch bei Qt hat man jedoch die Möglichkeit das gui mit einem gui Designer grafisch zu erstellen.</p>
<p>Wie auch Qt kann man Gtk entweder direkt in der Backend Sprache programmieren oder aus dem gui Designer, dann als xml exportieren. Der Code in der Dokumentation ist in C geschrieben, welches auch nicht die zugänglichste Sprache ist.</p>
<p>Die Verwendung von Gtk innerhalb des Programms scheint ähnlich einfach zu sein wie bei Qt. Die Installation ist allerdings unter Windows eher das Gegenteil von einfach.</p>
<p>Da die Kenntnisse gleich null sind, ist der Lernfaktor auf dem Maximum.</p>
<h4 id="electron">4.1.3.3 Electron</h4>
<p>Electron ist ein cross-plattform Framework zum Entwickeln von gui, welches dabei jedoch auf Technologien aus der Webentwicklung benutzt. Entwickelt wird Electron von der Firma Github und ist libre unter der MIT Lizenz [electronlicense].</p>
<p>Da Electron auf Technologien aus der Webentwicklung setzt, sind hier im Vergleich zu den anderen Frameworks bereit gute Kenntnisse vorhanden. Über die genau Funktion und Implementierung sind noch keine Kenntnisse vorhanden.</p>
<p>Die Verwendung von Webtechnologien macht Electron zwar sehr kompatibel auf den unterstützten Systemen, oftmals sehen die Applikationen jedoch eher wie eine Webseite als wie eine Desktop Applikation aus. Ein weiterer Nachteil ist der hohe Ressourcenverbrauch, da jede Applikation nahezu einer eigenen Instanz des Google Chrome Browsers gleich kommt.</p>
<p>Bei der Installation muss Node.js und der Paket Manager von Node.js, NPM, vorhanden sein. Zum Programmieren selber braucht es keine speziellen Tools. Ein Editor und ein Webbrowser sollten ausreichend sein.</p>
<p>Electron Applikationen bestehen hauptsächlich aus html, css und JavaScript Code. Wenn man sich die komplette Applikation in Node.js programmieren möchte, kommt dann noch eine zusätzliche Sprache hinzu. html ist ähnlich mühsam zu lesen wie xml. css und JavaScript sind relativ angenehm zu lesen, wobei es für beide keine offiziellen Styleguides gibt. Was bei Webanwendungen jedoch immer das schwierigste ist, ist der Wechsel zwischen verschiedenen Sprachen und Konzepten. Dieses Problem hat man bei Electron leider auch.</p>
<p>Das Setup von Electron ist etwa ähnlich kompliziert wie das Setup von Gtk und ist sehr ähnlich dem Entwickeln einer normalen Webapplikation.</p>
<p>Da an der IBZ Webtechnologien bereits intensiv behandelt worden sind und man in diesem Rahmen bereits ein paar Webapplikationen erstellt hat, wäre der Lernfaktor bei Electron wohl nicht so gross wie etwa bei Qt oder Gtk.</p>
<h3 id="ergebnis">4.1.4 Ergebnis</h3>
<p>Aufgrund der erreichten Punktzahl, Tabelle:(21), bei den vorhergehenden Variantenbewertungen, wurde entschieden für das Backend der Applikation auf Python zu setzen und fürs Frontend Qt zu benutzen.</p>
<h2 id="applikationsname">4.2 Applikationsname</h2>
<p>Da die einzusetzende Technologie nun feststeht lässt sich auch gut ein Name für die Applikation ableiten. Oftmals werden die grafischen Applikationen gleich benannt wie die Kommandozeilen Applikation aber mit dem Namen des gui Frameworks als Suffix. Somit wird das zu erstellende gui für borg im weiteren Verlauf der Arbeit nun Borg-Qt genannt</p>
<h2 id="testing">4.3 Testing</h2>
<p>Die Anwendung wird während der Realisierung soweit als möglich mit automatischen unittest und funktionstest überprüft. Dies hauptsächlich, um die Erfahrung in diesem Bereich zu erweitern um ein gutes Fundament für die Zukunft des Projektes zu bauen.</p>
<p>Aufgrund der Unerfahrenheit im Bereich des automatisierten Testings wurden noch die Testfälle in der Tabelle:(29), erstellt. Diese werden final von Hand überprüft. Somit kann vermieden werden, dass nicht funktionierende automatische Tests den Abschluss des Projektes verhindern. Da die Testfälle sich hauptsächlich an den Use Cases orientieren, gibt es ein paar Ziele die, dadurch nicht getestet werden können. Zudem sind zurzeit nur ca. 20 der Ziele durch die Use Cases abgedeckt. Die weiteren Ziele lassen sich erst sinnvoll integrieren, wenn die Basis für das Programm geschaffen wurde. Somit werden diese Ziele erst im Anschluss zur Diplomarbeit umgesetzt.</p>
<p>Getestet wird die Applikation jeweils auf dem Computer des Projektleiters. Auf diesem läuft die aktuelle Langzeitsupport Version (18.04) von Ubuntu [ubuntu] Linux, mit der GNOME Desktop Umgebung [gnome], als Betriebssystem. Die Tests werden jeweils gegen eine von PyInstaller generierte Binärdatei ausgeführt. Der genaue Vorgang der Erstellung dieser Datei wird in der Sektion: [Releases] beschrieben. Somit werden die Tests immer gegen eine veröffentlichbare Version gemacht.</p>
<p>Als Testdateien wird jeweils das Code Repository von Borg-Qt selber verwendet. Der Pfad des borg Repository für lokale Backups soll <code>/tmp/test-borgqt</code> sein, in den Testfällen „Lokales Repository“ genannt und das Passwort <code>foo</code>. Im Makefile des Repository wird dieses Setup definiert. Somit kann man als Entwickler nur <code>make init</code> ausführen und hat eine funktionsfähige Testumgebung.</p>
<p>Um Backups über ssh testen zu können, wird eine virtuelle Maschine mit Ubuntu 18.04 verwendet. Die Konfiguration der virtuellen Maschine sieht dabei wie folgt aus: * 2 CPU Kerne * 1024 MB RAM * IP: 10.7.89.117 * Ein User <code>borg</code> mit Passwort <code>borg</code> * borg Repository unter <code>/home/borg/backup/diplom</code> mit Passwort <code>foo</code>, in den Testfällen „Server Repository“ genannt * Der ssh Key des Entwicklers wird in den User <code>borg</code> importiert. Dies ermöglicht Passwort freie Logins.</p>
<p>Die Testfälle werden während der Entwicklung kontinuierlich durchgeführt. Am Ende der Diplomarbeit wird das finale Ergebnis des jeweiligen Testfalles erfasst. Allfällige Besonderheiten werden im Kapitel [Realisierung] beschrieben.</p>
<p>[Releases] siehe Abschnitt 5.11</p>
<p>[Realisierung] siehe Abschnitt 5</p>
<h2 id="klassendiagramm">4.4 Klassendiagramm</h2>
<p>Um die Abhängigkeiten zwischen den einzelnen Klassen der Anwendung aufzuzeigen, wurde ein Klassendiagramm, Abbildung:(34), erstellt. Das Klassendiagramm basiert auf dem UML Standard. Im Diagramm wurden nicht alle „Properties“ und Methoden alles Klassen aufgezeichnet, sondern nur solche, die auf eine andere Klasse verweisen. Dadurch bleibt das Diagramm übersichtlicher. Die Klassennamen, welche in fetter Schrift gehalten sind, wurden dabei vom Projektleiter erstellt. Die Klassennamen, welche kursiv sind, sind Klassen, welche entweder von Python oder Qt bereitgestellt werden.</p>
<h2 id="usability-studie">4.5 Usability-Studie</h2>
<p>Um Borg-Qt auf seine Nutzerfreundlichkeit zu testen, wird im Rahmen der Diplomarbeit noch eine kleine Usability-Studie gemacht. Bei einer solchen Studie erhalten die Probanden, Tabelle:(22), ein paar Aufgaben, Sektion 4.5.1, welche sie in einer begrenzten Zeit zu erledigen haben. Die Aufsichtsperson gibt ihnen dabei keinerlei Hilfestellungen. Die Probanden sollen die Aufgaben alleine mithilfe der Tipps und Hinweisen in der Anwendung lösen. Im Anschluss bewerten die Probanden dann die einzelnen Aufgaben nach ihrer Schwierigkeit, Tabelle:(23). Daraus lässt sich dann eine sogenannte Heatmap erstellen. Aus der Heatmap kann man anschaulich herauslesen, welche Bereiche für die User noch zu kompliziert sind und Nacharbeit benötigen.</p>
<p>Die Probanden wurden aus dem Umfeld des Projektleiters ausgewählt. Es wurde dabei versucht ein einigermassen breites Spektrum an Computerkenntnissen abzudecken. Da die Anwendung allen Erfahrungsstufen behilflich sein soll. Die Angaben in der Tabelle:(22) sind jedoch die Selbsteinschätzung der Probanden und nicht die des Projektleiters.</p>
<h3 id="aufgaben">4.5.1 Aufgaben</h3>
<ol type="1">
<li>Du möchtest deine Dateien sichern. Erstelle dazu eine Datensicherung des Ordners <code>/home/testuser/Downloads</code>.</li>
<li>Du hast aus Versehen die Datei <code>/home/testuser/Downloads/Example.pdf</code> gelöscht. Stelle die Datei wieder her. Am Ende soll sie unter <code>/home/testuser/Documents/Example.pdf</code> zu finden sein.</li>
<li>Stelle ein beliebiges Archiv wieder her. Der Zielpfad ist <code>/home/testuser/Documents/</code>.</li>
<li>Lösche ein Archiv deiner Wahl.</li>
<li>Du möchtest, dass der Ordner <code>/home/testuser/Pictures/</code> nicht mehr gesichert wird. Konfiguriere die Applikation entsprechend.</li>
</ol>
<h3 id="resultate">4.5.2 Resultate</h3>
<h4 id="proband-1">4.5.2.1 Proband 1</h4>
<p>Der Proband fand die Aufgaben grundsätzlich einfach zu lösen. Dass die „Mount“ Funktion zum Wiederherstellen einzelner Dateien gedacht war, hat er nicht erkannt.</p>
<h4 id="proband-2">4.5.2.2 Proband 2</h4>
<p>Der Proband kam mit den Aufgaben insgesamt gut klar. Bei der ersten Aufgabe hätte er sich eine Meldung gewünscht, wenn das Backup erfolgreich durchgelaufen ist. Wie Proband 1 hat auch er die „Mount“ Funktion nicht genutzt zum Wiederherstellen einer einzelnen Datei. Text Hinweise wurden nur bedingt wahrgenommen.</p>
<h4 id="proband-3">4.5.2.3 Proband 3</h4>
<p>Proband 3 kam mit der Anwendung an sich gut klar. Die Aufgabe Zwei fand er über alles gesehen auch am schwierigsten, da er mit der Materie nahezu nicht vertraut ist. Als zusätzlichen Input gab er an, dass ein Kontextmenü, welches sich mit Rechtsklick auf ein Element öffnet, etwas sei was er gerne hätte, da er andere Anwendungen oft so steuert. Aufgabe 5 war auch etwas herausfordernder als 1,3 und 4, insbesondere war unklar wie der Ordner zu der Liste hinzugefügt werden sollte.</p>
<p>Während des Tests ist in der Anwendung noch ein Bug aufgetaucht, welcher unter gewissen Umständen Probleme beim Erstellen von Archiven machte. Die detaillierte Lösung dafür ist im Kapitel 5 beschrieben.</p>
<h4 id="proband-4">4.5.2.4 Proband 4</h4>
<p>Bei Proband 4 war die grösste Hürde, dass das Interface nur in Englisch verfügbar war. Bei Aufgabe Zwei hatte er sich nach eigenen Angaben etwas verloren gefühlt und hätte sich auch ein Kontextmenü auf dem Rechtsklick gewünscht. Mit etwas Hilfe bei der Übersetzung waren die restlichen Aufgaben jedoch gut zu meistern.</p>
<h4 id="probandin-5">4.5.2.5 Probandin 5</h4>
<p>Probandin 5 mit der Anwendung insgesamt sehr gut klar und hat auch als Einzige die Tooltips auf den Buttons entdeckt und dann genutzt. Aufgabe 2 war jedoch auch schwierig zu lösen, danach ging es jedoch ohne Probleme.</p>
<h3 id="auswertung">4.5.3 Auswertung</h3>
<p>Alle Testpersonen konnten die Applikation nach anfänglichen Bedienungsschwierigkeiten sehr gut bedienen. Um Hilfestellung zu leisten, wird im Rahmen der Diplomarbeit noch ein Hilfefenster eingebaut, welches den Benutzern beim ersten Starten der Anwendung angezeigt wird und kurz die jeweiligen Elemente des Interfaces anzeigt. Somit sollte auch das Problem bei der Aufgabe Zwei etwas abgeschwächt werden. Eines der Hauptprobleme war dort, dass die Probanden nicht herausgefunden haben, dass der schnellste Weg eine einzelne Datei wieder herzustellen über die „Mount“ Funktion ginge. Die Einarbeitung in die Thematik von Backups würde sich jedoch wohl nur sehr schwer über das gui realisieren lassen. Hier müsste auf jeden Fall eine Dokumentation oder im Idealfall eine Schulung Abhilfe schaffen.</p>
<p>Der von zwei Usern geäusserte wertvolle Hinweis, ein Kontextmenü anzubieten, wird in die künftige Weiterentwicklung der Applikation eingepflegt. Aus Ressourcengründen allerdings erst nach der Diplomarbeit.</p>
<p>Ein Pop-Up, welches ein erfolgreiches Erstellen eines Archivs bestätigt, wird nicht eingebaut. Bei erfolgreicher Durchführung verschwindet der Fortschrittsdialog und in der Archivlist erscheint ein weiterer Eintrag. Das sind zwar nicht die offensichtlichsten Hinweise im Falle eines Fehlers, erscheint jedoch sofort ein Dialog, der darauf hinweist. Somit sollten die beiden Vorgänge genügend unterschieden sein und es hat auch kein anderer Proband das Bedürfnis nach einer Bestätigung.</p>
<p>Eine Deutschübersetzung, eine weitere Anforderung der Usability Tester, wird auch für zukünftige Entwicklungen aufgenommen und nicht im Rahmen der Diplomarbeit umgesetzt.</p>
<p>Im Rahmen der Diplomarbeit werden noch einige Texte angepasst. An gewissen Stellen war die Rede von „Backups“ und an anderen von „Archives“. Da borg sie selber „Archives“ nennt, sollte Borg-Qt noch so angepasst werden das überall von „Archives“ die Rede ist. Zudem wird bei den „Include“ und „Exclude“ Optionen über der Liste noch ein Label hinzugefügt, um die Elemente zu beschreiben. Schlussendlich werden die Buttons „Add file“ und „Add folder“ zu „Exclude file“ und „Exclude folder“ sowie „Include file“ und „Include folder“ umbenannt. Somit zeigen die Buttons dann auch direkt, dass sie Dateien respektive Ordner ein-/ausschliessen. Ein paar der Probanden hatten es zuerst über den „Remove“ Button versucht.</p>
<h1 id="realisierung">5 Realisierung</h1>
<h2 id="cross-plattform-kompatibilität">5.1 Cross-plattform Kompatibilität</h2>
<p>Um sicherzugehen, dass die gewählten Technologien auch den Anforderungen entsprechen wurde ein kleines „Hello World“ Programm mit Python3 und Qt geschrieben. Dieses läuft ohne jegliche Probleme und Anpassung auf Windows, Linux und OS X. Wie in den Screenshots in Abbildung:(14) zu sehen ist.</p>
<p><a href="file:pictures/hello_world.png" class="uri">file:pictures/hello_world.png</a></p>
<h2 id="benutzerinterface">5.2 Benutzerinterface</h2>
<h3 id="inspiration">5.2.1 Inspiration</h3>
<p>In der Vorstudie zur Diplomarbeit wurde borg mit der Software „Back in Time“[backintime] verglichen. „Back in Time“ setzt auf Rsync zum Kopieren der Dateien. Dies erlaubt es „Back in Time“ auch schnelle Backups über ssh zu machen allerdings ohne dedup.</p>
<p>Das übersichtliche Userinterface in Abbildung:(15), wurde für Borg-Qt als Vorlage genommen. Insbesondere die einfache und direkte Art ein Backup eines spezifischen Pfades zu machen ist sehr gelungen. Da sie es dem User so einfach wie möglich macht ein Backup zu erstellen.</p>
<p><a href="file:pictures/bit_main.png" class="uri">file:pictures/bit_main.png</a></p>
<h3 id="erste-umsetzung">5.2.2 Erste Umsetzung</h3>
<p>Qt bietet einem mehrere Möglichkeiten zum Erstellen der grafischen Oberfläche. Zum einen kann die ganze Oberfläche programmatisch erstellt werden. Dies gibt dem Entwickler ein grosses Mass an Kontrolle, ist allerdings nicht sehr intuitiv.</p>
<p>Die angenehmere Variante ist es den Qt Designer, Abbildung:(16), zu nutzen. Mit diesem lassen sich die Oberflächen in einer grafischen Oberfläche designen und auch gleich starten. Damit ist direkt zu sehen wie sich die Oberflächen auf dem System verhalten.</p>
<p><a href="file:pictures/qt_designer.png" class="uri">file:pictures/qt_designer.png</a> Mit der ersten gui Version wurden die ersten Basisziele der Projektarbeit umgesetzt. Im Hauptfenster, Abbildung:(17), befinden sich wie auch bei „Back in Time“ in der einen Hälfte eine Liste der vorhandenen Archive und in der anderen Hälfte ein Dateimanager. Dieser dient zur Auswahl des zu sichernden Pfades. Im oberen Bereich findet sich die Toolbar mit den Aktionen, die der User ausführen kann. Gemäss den Use Cases sind dies „Backup, Restore, Mount, Delete und Settings“.</p>
<p>Bei den Icons wurde zuerst versucht diese nach der „Icon Naming Specification“[iconnamespec] auszuwählen. Diese Spezifikationen würden es erlauben einfach den definierten Namen des Icons anzugeben. Qt würde dann jeweils das passende Icon basierend auf dem System anzeigen. Somit wären die Icons passend zum jeweiligen Betriebssystem. Allerdings gab es für die Aktionen keine passenden Icons in der Spezifikation. Deshalb wurden schlussendlich das „Feather“ Icon Theme Set [feathericons] ausgewählt. Dabei handelt es sich um ein freies Icon Theme unter der MIT Lizenz, welches die Icons als svg Dateien bereitstellt. Dadurch können die Icons frei skalieren und funktionieren auch auf Geräten mit einer hohen Auflösung.</p>
<p><a href="file:pictures/borgqt_main_v1.png" class="uri">file:pictures/borgqt_main_v1.png</a></p>
<p>Im Einstellungsfenster gibt es drei Tabs zur Auswahl. Einmal den „General“ Tab, Abbildung:(18), dieser zeigt allgemeine Optionen an. Im zweiten Tab „Include“, Abbildung:(19), kann der User die Ordner und Dateien auswählen, die er sichern will. Der dritte Tab „Exclude“, Abbildung:(20), gibt dem User die Möglichkeit einzelne Ordner oder Dateien von den Backups auszuschliessen.</p>
<p><a href="file:pictures/borgqt_settings_general_v1.png" class="uri">file:pictures/borgqt_settings_general_v1.png</a></p>
<p><a href="file:pictures/borgqt_settings_include_v1.png" class="uri">file:pictures/borgqt_settings_include_v1.png</a></p>
<p><a href="file:pictures/borgqt_settings_exclude_v1.png" class="uri">file:pictures/borgqt_settings_exclude_v1.png</a></p>
<p>Das „Progress“ Dialogfenster, Abbildung:(21), zeigt dem User einen Fortschrittsbalken und einen „Cancel“ Button zum Abbrechen der Aktion an. Das Fenster ist generisch gehalten, damit es von verschiedenen Tasks gleichermassen genutzt werden kann.</p>
<p><a href="file:pictures/borgqt_progress_v1.png" class="uri">file:pictures/borgqt_progress_v1.png</a></p>
<h2 id="einstellungen">5.3 Einstellungen</h2>
<p>Die Einstellungen werden von der Applikation benötigt, um die vom User definierten Vorgaben auszuführen, das Backup Repository zu finden, etc. Diese Einstellungen sollen in einer Klar-Text Datei gespeichert werden. Dies hat zum einen den Vorteil, dass man die Einstellungen sehr einfach sichern kann. Zum anderen kann man die Einstellungen der Applikation auch anpassen, ohne dass man die Applikation selber starten muss.</p>
<h3 id="backend-1">5.3.1 Backend</h3>
<p>Zum Erstellen und Auslesen der Konfigurationsdatei wurde das Python Standard Modul <code>configparser</code> [configparser] verwendet. Dieses macht es einem sehr einfach eine Datei im „INI“ Stil zu erstellen und parsen.</p>
<p>„INI“ Stil bedeutet dabei das die Einstellungen in „Key/Value“ Paaren gespeichert werden. Somit kann man einfach auf den benötigten Wert zugreifen, in dem man seinen Schlüssel angibt. Ein Beispiel ist im Code Snippet: (2) zu sehen.</p>
<pre><code> # docs/borg_qt.conf.example
 [borgqt]
 includes = [
        &quot;/home/username/&quot;,
         &quot;/home/otheruser/Downloads&quot;
    ]
 repository_path = /tmp/test-borgqt
 password = foo
 prefix = muster</code></pre>
<p>Programmlisting 2 Ein Beispiel einer INI Datei.</p>
<p>Das Auslesen und Schreiben der Konfigurationsdatei liess sicher relativ einfach realisieren. Die grösste Herausforderung dabei war, dass <code>Configparser</code> keinen Support für eine Liste von Werten hat. Die wurde insbesondere für <code>include</code> und <code>exclude</code> Pfade benötigt. Also für die Pfade, welche gesichert werden oder von einem Backup ausgeschlossen werden sollen.</p>
<p>Abhilfe schaffte hier ein Stackexchange Post [configlist]. Dieser schlug vor, dass man die Liste im json Format speichern soll. Da <code>Configparser</code> alle Werte im Format „String“ zurückgibt, können dann die json Listen sehr einfach von einem json Parser umgewandelt werden. Im Projekt wurde dies dann unter anderem als Methode der <code>Config</code> Klasse, Code Snippet:(3), implementiert. Somit muss man jeweils nur die <code>_return_list_option()</code> Methode mit der benötigten Option als Argument aufrufen und bekommt als Resultat eine funktionierende Python Liste zurück.</p>
<p>Beim Schreiben der Konfigurationsdatei macht man dann einfach das Umgekehrte. Man konvertiert eine Python Liste in einen json String.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a> <span class="co"># borg_qt/config.py</span></span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a> <span class="kw">def</span> _return_list_option(<span class="va">self</span>, option):</span>
<span id="cb2-4"><a href="#cb2-4"></a>     <span class="co">&quot;&quot;&quot;Reads the provided option from the configparser object and returns</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">     it as a list.&quot;&quot;&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>     <span class="cf">if</span> option <span class="kw">in</span> <span class="va">self</span>.config[`borgqt`]:</span>
<span id="cb2-7"><a href="#cb2-7"></a>         <span class="cf">return</span> json.loads(<span class="va">self</span>.config[`borgqt`][option])</span>
<span id="cb2-8"><a href="#cb2-8"></a>     <span class="cf">else</span>:</span>
<span id="cb2-9"><a href="#cb2-9"></a>         <span class="cf">return</span> []</span></code></pre></div>
<p>Programmlisting 3 Methode zum Parsen von JSON Listen in Konfigurationsdateien.</p>
<p>Die Datei wird jeweils beim Start der Applikation gelesen und angewendet. Somit weiss die Applikation bereits nach dem Start wo das Repository liegen sollte und wie die Login Daten dafür sind. Dies geschieht mittels der Methode <code>_get_path</code>, Codesnippet:(4). Es gibt dabei zwei mögliche Pfade, wo die Konfigurationsdatei liegen könnte. Befindet sich die Datei nicht am vorgegeben Pfad <code>~/.config/borg_qt/borg_qt.conf</code> oder direkt „neben“ dem Binary, gibt die Applikation eine entsprechende Meldung, Abbildung:(22), aus. Der Hauptpfad unter <code>~/.config/borg_qt/borg_qt.conf</code> wird dabei gemäss dem Ziel Nr. 21 über die Umgebungsvariable <code>HOME</code> zusammengesetzt</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a> <span class="co"># borg_qt/config.py</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a> <span class="kw">def</span> _get_path(<span class="va">self</span>):</span>
<span id="cb3-4"><a href="#cb3-4"></a>     <span class="co">&quot;&quot;&quot;searches for the configuration file and returns its full path.&quot;&quot;&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>     home <span class="op">=</span> os.environ[`HOME`]</span>
<span id="cb3-6"><a href="#cb3-6"></a>     dir_path <span class="op">=</span> os.path.dirname(os.path.realpath(<span class="va">__file__</span>))</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>     <span class="cf">if</span> os.path.exists(os.path.join(home, `.config<span class="op">/</span>borg_qt<span class="op">/</span>borg_qt.conf`)):</span>
<span id="cb3-9"><a href="#cb3-9"></a>         <span class="cf">return</span> os.path.join(home, `.config<span class="op">/</span>borg_qt<span class="op">/</span>borg_qt.conf`)</span>
<span id="cb3-10"><a href="#cb3-10"></a>     <span class="cf">elif</span> os.path.exists(os.path.join(dir_path, `borg_qt.conf`)):</span>
<span id="cb3-11"><a href="#cb3-11"></a>         <span class="cf">return</span> os.path.join(dir_path, `borg_qt.conf`)</span>
<span id="cb3-12"><a href="#cb3-12"></a>     <span class="cf">else</span>:</span>
<span id="cb3-13"><a href="#cb3-13"></a>         <span class="cf">raise</span> BorgException(<span class="st">&quot;Configuration file not found!&quot;</span>)</span></code></pre></div>
<p>Programmlisting 4 Methode zum Suchen der Konfigurationsdatei</p>
<p><a href="file:pictures/borgqt_missing_config.png" class="uri">file:pictures/borgqt_missing_config.png</a></p>
<h3 id="frontend-1">5.3.2 Frontend</h3>
<p>Zur Vereinfachung der Bedienbarkeit wurde die Applikation, um eine grafische Konfigurationsmöglichkeit erweitert. Diese stellt dabei hauptsächlich die Werte aus der Konfigurationsdatei grafisch dar und übergibt allenfalls geänderte Werte ans Backend, welches die Konfiguration, dann wieder in der Datei speichert.</p>
<p>Qt kennt keinen Mechanismus zum Auslesen aller Elemente aus einem sogenannten <code>QListWidget</code>, einem gui Element, welches Listen darstellt. Die Elemente müssen somit zuerst in einer Zwischenliste gespeichert werden, bevor sie zurück in das <code>Configparser</code> Objekt geschrieben. Im Code sieht dies dann wie in Codesnippet:(5) aus. Dabei wird jedes Element einzeln aus dem <code>QListWidget</code> geholt und in die Zwischenliste geschoben. Im zweiten Teil wird die Liste dann wieder zu einem json String konvertiert und im <code>Configparser</code> Objekt gespeichert. Die Option <code>indent=4</code> dient dabei der Lesbarkeit, damit nicht der ganze json String auf ein Zeile in der Konfigurationsdatei gespeichert wird, sondern jedes Listenelement seine eigene Zeile erhält.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a> <span class="co"># borg_qt/config.py</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a> <span class="co"># Workaraound to get all items of a QListWidget as a list</span></span>
<span id="cb4-4"><a href="#cb4-4"></a> includes <span class="op">=</span> []</span>
<span id="cb4-5"><a href="#cb4-5"></a> <span class="cf">for</span> index <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.list_include.count()):</span>
<span id="cb4-6"><a href="#cb4-6"></a>     includes.append(<span class="va">self</span>.list_include.item(index).text())</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a> <span class="co"># Configparser doesn`t know about list therefore we store them as json</span></span>
<span id="cb4-9"><a href="#cb4-9"></a> <span class="co"># strings</span></span>
<span id="cb4-10"><a href="#cb4-10"></a> <span class="va">self</span>.config[`borgqt`][`includes`] <span class="op">=</span> json.dumps(includes,</span>
<span id="cb4-11"><a href="#cb4-11"></a>                                                indent<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb4-12"><a href="#cb4-12"></a>                                                sort_keys<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<p>Programmlisting 5 Workaround zum Auslesen aller Elemente in QListWidgets.</p>
<h2 id="borg-interface">5.4 Borg Interface</h2>
<p>Zuerst erschien es sinnvoll die Kommunikation zwischen borg und Borg-Qt über einfache Funktionen laufen zu lassen. Dieser Ansatz hatte allerdings zwei Probleme. Zum einen wurde es relativ umständlich Informationen zu verarbeiten und weiterzugeben, zum anderen führte es zu dem unschönen Nebeneffekt, dass das gui eingefroren ist. Eine Recherche ergab, dass Threads hier Abhilfe schaffen könnten.</p>
<p>Python liefert für Threads das Modul <code>threading.Thread</code> [threading], mit. In der Praxis lies sich der Fortschrittsdialog und der Thread jedoch nicht so verknüpfen das sich der Dialog schliesst, wenn das Backup durchgelaufen ist und der Thread wieder entfernt wird. Aus diesem Grund wurde dann ein erfolgreicher Test mit dem PyQt Modul <code>QThread</code> [qthread] gemacht. Nach Beendigung des Backups wird der Fortschrittsdialog automatisch geschlossen. Auch das Stoppen des Threads mit einem Klick auf den „Cancel“ Button funktioniert einwandfrei.</p>
<p>Damit borg aus der Anwendung angesteuert werden kann wird das Python Modul <code>subprocess</code> [subprocess] verwendet. Dieses erlaubt einem neue Prozesse zu erstellen, welche man oftmals benötigt um etwa, wie im Fall von Borg-Qt, externe Applikationen zu starten, zu steuern und ihre Ausgabewerte auszulesen. Das effektive Kommando wird dann aus dem Property <code>self.command</code> gelesen.</p>
<p>Damit borg die Ausgabe im json Format ausgibt, muss man man noch die Parameter <code>--log-json</code> und <code>--json</code> mitgeben. Der erste Parameter ändert hauptsächlich das Format von Errormeldungen und der zweite formatiert dann die finale Ausgabe. Die Ausgaben werden jeweils an Variablen weitergegeben (<code>json_output</code> und <code>json_error</code>) welche im weiteren Code verarbeitet werden.</p>
<p>Insbesondere <code>json_error</code> ist für den weiteren Programmablauf von grosser Wichtigkeit. Wenn Borg ein Problem feststellt, wird die Error Meldung von borg an <code>json_error</code> weitergegeben. Mittels der Methode im Codesnippet:(6), wird die Variabel ausgewertet und im Falle eines Fehlers wirft der Code eine Exception, welche im Hauptprogramm abgefangen wird. Dabei wird eine Fehlermeldung in einem separaten Fenster ausgegeben. Die Methode wurde dabei auf der Klasse <code>BorgQtThread</code> umgesetzt und steht somit allen Funktionen zur Verfügung. Die Fehlermeldung bei einer fehlenden Konfigurationsdatei, Abbildung:(22), funktioniert nach dem gleichen Prinzip und konnte somit zum grössten Teil wiederverwendet werden. Der restliche json Output kann dann einfach mit dem <code>json</code> Modul geparst werden. Somit werden dem User, gemäss Ziel Nr. 14, direkt die Fehlermeldungen von borg angezeigt und es muss nur an gewissen Stellen noch applikationsspezifisches Exception Handling betrieben werden.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a> <span class="co"># borg_qt/borg_interface.py</span></span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a> <span class="kw">def</span> process_json_error(<span class="va">self</span>, json_err):</span>
<span id="cb5-4"><a href="#cb5-4"></a>     <span class="cf">if</span> json_err:</span>
<span id="cb5-5"><a href="#cb5-5"></a>         error_list <span class="op">=</span> json_err.split(`<span class="op">\</span>n`)</span>
<span id="cb5-6"><a href="#cb5-6"></a>         <span class="cf">if</span> <span class="st">&quot;borg.locking&quot;</span> <span class="kw">in</span> error_list[<span class="dv">0</span>]:</span>
<span id="cb5-7"><a href="#cb5-7"></a>             <span class="cf">pass</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>         <span class="cf">else</span>:</span>
<span id="cb5-9"><a href="#cb5-9"></a>             err <span class="op">=</span> json.loads(error_list[<span class="dv">0</span>])</span>
<span id="cb5-10"><a href="#cb5-10"></a>             <span class="cf">raise</span> BorgException(err[`message`])</span></code></pre></div>
<p>Programmlisting 6 Auswertung der json err Variabel.</p>
<p>Die ganze Funktionalität wurde dann in der Klasse <code>BorgQtThread</code> zusammengefasst. Somit kann für jede Funktion von borg eine einzelne Klasse geschrieben werden, welche dann von <code>BorgQtThread</code> die Funktionen erbt. Die Funktionsklassen müssen dann jeweils nur die Methode <code>self.create_command(self)</code> implementieren, welche das Property <code>self.command</code> erstellt und die einfachen Funktionen von borg sollten direkt funktionieren.</p>
<h2 id="backup">5.5 Backup</h2>
<p>Daten zu sichern ist die primäre Funktion von Borg-Qt. Deshalb soll das Erstellen eines Backups so schnell und unkompliziert wie möglich vonstattengehen.</p>
<h3 id="backend-2">5.5.1 Backend</h3>
<p>Um Backups erstellen zu können, wurde die Klasse <code>BackupThread</code> erstellt, welche von <code>BorgQtThread</code> erbt. Die Klasse <code>BackupThread</code> nimmt beim instantiieren 3 Argumente auf: <code>includes</code>, <code>excludes</code>, <code>prefix</code>. Wobei <code>excludes</code> und <code>prefix</code> beide optional sind. Im Hauptcode werden diese Argumente aus der Konfigurationsdatei ausgelesen und übergeben. Die Includes werden im Falle eines Backups im Hintergrund aus der Konfigurationsdatei gelesen. Wenn es der User manuell ausführt, wird der im Frontend ausgewählte Pfad mitgegeben.</p>
<p>Die „Excludes“ haben lange nicht funktioniert. Der Grund dafür waren zusätzliche Anführungszeichen um die Exclude Pfade. Diese wurden aus Versehen hinzugefügt, da borg normalerweise auf der Kommandozeile ausgeführt wird und die Anführungszeichen dort notwendig sind, um allfällige Leer- oder Sonderzeichen abzufangen. Es wurde davon ausgegangen, dass das <code>subprocess</code> Modul ähnlich funktioniert wie die Kommandozeile. Da man an das Modul direkt einen String übergibt, sind die zusätzlichen Anführungszeichen nicht notwendig und führen sogar dazu, dass die Pfade gar nicht funktionieren. Somit werden die „Excludes“ mittels der Methode <code>_process_excludes</code> mit dem entsprechenden Parameter gepaart und als gesamte Liste an das finale Kommando angehängt. Die „Includes“ funktionieren auf die gleiche Weise, benötigen jedoch keine zusätzlichen Parameter. Zu sehen ist dies im Codesnippet:(7).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a> <span class="co"># borg_qt/borg_interface.py</span></span>
<span id="cb6-2"><a href="#cb6-2"></a> <span class="co"># Funktion zum Verarbeiten der &quot;Excludes&quot;</span></span>
<span id="cb6-3"><a href="#cb6-3"></a> <span class="kw">def</span> _process_excludes(<span class="va">self</span>, excludes):</span>
<span id="cb6-4"><a href="#cb6-4"></a>     processed_items <span class="op">=</span> []</span>
<span id="cb6-5"><a href="#cb6-5"></a>     <span class="cf">if</span> excludes:</span>
<span id="cb6-6"><a href="#cb6-6"></a>         <span class="cf">for</span> item <span class="kw">in</span> excludes:</span>
<span id="cb6-7"><a href="#cb6-7"></a>             processed_items.extend([`<span class="op">-</span>e`, item])</span>
<span id="cb6-8"><a href="#cb6-8"></a>         <span class="cf">return</span> processed_items</span>
<span id="cb6-9"><a href="#cb6-9"></a>     <span class="cf">else</span>:</span>
<span id="cb6-10"><a href="#cb6-10"></a>         <span class="cf">return</span> processed_items</span>
<span id="cb6-11"><a href="#cb6-11"></a></span>
<span id="cb6-12"><a href="#cb6-12"></a> <span class="co"># Methode zum Erstellen des gls:borg Kommandos.</span></span>
<span id="cb6-13"><a href="#cb6-13"></a> <span class="kw">def</span> create_command(<span class="va">self</span>):</span>
<span id="cb6-14"><a href="#cb6-14"></a>     <span class="va">self</span>.command <span class="op">=</span> [`borg`, `create`, `<span class="op">--</span>log<span class="op">-</span>json`, `<span class="op">--</span>json`,</span>
<span id="cb6-15"><a href="#cb6-15"></a>                     (`::`</span>
<span id="cb6-16"><a href="#cb6-16"></a>                         <span class="op">+</span> <span class="va">self</span>.prefix</span>
<span id="cb6-17"><a href="#cb6-17"></a>                         <span class="op">+</span> `{now:<span class="op">%</span>Y<span class="op">-%</span>m<span class="op">-%</span>d_<span class="op">%</span>H:<span class="op">%</span>M:<span class="op">%</span>S}`)]</span>
<span id="cb6-18"><a href="#cb6-18"></a>     <span class="va">self</span>.command.extend(<span class="va">self</span>.includes)</span>
<span id="cb6-19"><a href="#cb6-19"></a>     <span class="cf">if</span> <span class="va">self</span>.excludes:</span>
<span id="cb6-20"><a href="#cb6-20"></a>         <span class="va">self</span>.command.extend(<span class="va">self</span>.excludes)</span></code></pre></div>
<p>Programmlisting 7 Erstellen des „borg create“ Kommandos fürs erstellen von Backups.</p>
<h3 id="frontend-2">5.5.2 Frontend</h3>
<p>Damit die Backups im Frontend funktionieren, musste zum einen der „Backup“ Knopf mit der Methode <code>create_backup</code> verknüpft werden. Des Weiteren wurde ein Dateibaum, in Abbildung:(23) grün umrahmt, eingefügt. Dieser gibt den Pfad des angewählten Objektes and die <code>create_backup</code> Methode weiter.</p>
<p><a href="file:pictures/borgqt_file_tree.png" class="uri">file:pictures/borgqt_file_tree.png</a></p>
<p>Während dem ein Archiv erstellt wird, wird ein kleiner Dialog mit Ladebalken angezeigt, Abbildung:(24). Dieser dient hauptsächlich dazu dem User das Gefühl zu geben, dass die Applikation noch am Arbeiten ist.</p>
<p>Der Dialog musste gegenüber der ersten Version in Sektion: [Erste Umsetzung] noch etwas angepasst werden. borg gibt, während dem Erstellen eines Archivs keine Informationen zurück, welche es einem erlauben würden einen Fortschrittsbalken zu generieren, welcher den effektiven Fortschritt anzeigt. borg gibt einzig die Anzahl der verarbeiteten Dateien in regelmässigen Abständen zurück. Da borg jedoch zu Beginn nicht meldet, wie viele Dateien gesichert werden, lässt sich damit keine Prozentzahl erstellen. Ein paar Experimente, bei denen die zu sichernden Dateien zuerst von Borg-Qt gezählt werden sollten, wurden verworfen. Einerseits weil keine Methode gefunden werden konnte, welche die gleiche Anzahl Dateien zurückgab wie borg. Anderseits, weil es den Backup Vorgang unnötig in die Länge zieht. Dies ist insbesondere der Fall, wenn sich sehr viele Dateien im Quellverzeichnis befinden. Es kann sogar soweit kommen, dass das Zählen länger als das eigentliche Sichern dauert. Aus diesem Grund wurde der Fortschrittsbalken mit Prozentanzeige durch einen sich wiederholenden Ladebalken ersetzt.</p>
<p><a href="file:pictures/borgqt_progress_v2.png" class="uri">file:pictures/borgqt_progress_v2.png</a></p>
<p>Wurde das Archiv erfolgreich erstellt, wird die Liste mit den Archiven sowie die Repository Statistik aktualisiert. Beide Elemente sind in der Abbildung:(25), grün respektive rot umrahmt. Für die beiden Funktionen wurde jeweils eine eigene Klasse, <code>ListThread</code> und <code>InfoThread</code>, erstellt. Beide erben von <code>BorgQtThread</code>. In den Klassen wird wie bei <code>BackupThread</code> borg über einen <code>subprocess</code> aufgerufen, um die Archiv Liste respektive Statistik zurückzuerhalten Die json Strings werden wieder auf die jeweilige Information geparst und die Archive in eine Python Liste, die Repository Statistik, in Zahlen umgewandelt.</p>
<p>Da borg die Repository Grössen in Bytes zurückgibt, sollten diese zur Anzeige noch in eine Menschen lesbarses Format umgerechnet werden. In Borg-Qt geschieht dies mit der Helferfunktion <code>convert_size</code>. Die Funktion wurde von Stackoverflow [sizeformat] übernommen.</p>
<p>Beim Durchführen der Usability-Studie wurde noch ein Bug entdeckt welcher die Anwendung zum Abstürzen brachte. Der Bug, der entdeckt wurde, tritt immer dann auf, wenn ein Archiv gemountet ist während man ein Archiv erstellen möchte. Dies ist jedoch offenbar eine Funktion die von borg nicht unterstützt wird [borgmountissue]. borg kann mehrere Archive gleichzeitig mounten. Der User müsste jedoch jedes der Archive zuerst wieder unmounten bevor er eine neue Datensicherung erstellen kann. Das Problem wurde dadurch gelöst, dass dem User ein Dialog angezeigt wird, über welchen er vor einer Datensicherung zuerst die gemounteten Archive aushängen kann. Anschliessend startet die Datensicherung, wie wenn kein Archiv gemountet gewesen wäre.</p>
<p><a href="file:pictures/borgqt_archive_list.png" class="uri">file:pictures/borgqt_archive_list.png</a></p>
<p>[Erste Umsetzung] siehe Abschnitt 5.2.2</p>
<h2 id="restore">5.6 Restore</h2>
<p>Der Code für das Wiederherstellen eines Archivs ist sehr ähnlich wie der Code für das Erstellen. Die Besonderheiten bei dieser Funktion sind vor allem die Kontrolle, dass ein Archiv angewählt wurde, bevor man die Wiederherstellung startet, das Erstellen des Zielpfades sowie das Aufräumen bei einem Fehler.</p>
<p>Wird der „Restore“ Knopf gedrückt ohne das ein Archiv angewählt wurde, erscheint folgende Fehlermeldung, Abbildung:(26), um den Benutzer darauf hinzuweisen, das er dies noch tun sollte.</p>
<p><a href="file:pictures/borgqt_no_archive_selected.png" class="uri">file:pictures/borgqt_no_archive_selected.png</a></p>
<p>Für die Wiederherstellung einer Datensicherung, selektiert der User das gewünschte Archiv. Als zweiten Schritt startet er den Prozess mit Klick auf „Restore“. Im sich automatisch öffnenden Dialogfenster, ist der gewünschte Zielort auszuwählen. Ist der Zielort festgelegt, erstellt Borg-Qt ein Subverzeichnis mit dem Namen des Archivs und beginnt mit der eigentlichen Wiederherstellung. Ist der Zielort für die Applikation nicht beschreibbar erscheint die Fehlermeldung, Abbildung:(27), und der Vorgang wird abgebrochen. Nach der erfolgreichen Wiederherstellung öffnet die Applikation den Zielort in einem Dateimanager, damit der User gleich mit den Dateien weiterarbeiten kann.</p>
<p><a href="file:pictures/borgqt_not_writeable.png" class="uri">file:pictures/borgqt_not_writeable.png</a></p>
<p>Gibt es, während dem Wiederherstellen, einen Fehler gibt die Anwendung den entsprechenden Fehler aus und löscht zusätzlich noch den zu Beginn erstellten Archiv Ordner.</p>
<p>Wird das gleiche Archiv nochmal an den gleichen Zielort wiederhergestellt, werden bereits vorhandene Dateien überschrieben.</p>
<h2 id="mount">5.7 Mount</h2>
<p>Die „Mount“ Funktion prüft zuerst ob der Benutzer ein Archiv angewählt hat und gibt, falls dies nicht der Fall ist, eine entsprechende Fehlermeldung aus. Im Gegensatz zur „Restore“ Funktion zeigt die „Mount“ Funktion jedoch keinen Dialog zum Auswählen des Zielpfades. Die Funktion erstellt sich diesen selbst. Der Zielpfad ist dabei kombiniert aus dem <code>/tmp</code> Verzeichnis und dem Namen des Archivs</p>
<p>borg mountet jedes Archiv nur mit Leserechten. Es ist relativ unwahrscheinlich, dass der Zielpfad in unbeschreibbarer Form bereits vor dem Ausführen der <code>mount_backup</code> Methode bereits vorhanden ist. Ist dies der Fall kann davon ausgegangen werden, dass der Benutzer das Archiv bereits einmal gemountet hat. Genau dies wird in der Applikation auch so überprüft. Hat die Applikation Schreibrechte auf den Zielpfad, wird das ausgewählte Archiv auf diesem Pfad gemountet. Anschliessend wird der Pfad in einem Dateimanager geöffnet, damit der Benutzer direkt mit den Dateien weiterarbeiten kann. Wurde erkannt, dass das Archiv bereits gemountet wurde, also der Pfad nicht schreibbar ist, öffnet die Applikation direkt den Dateimanager, ohne zu versuchen das Archiv noch einmal zu mounten.</p>
<p>Zusätzlich wird der Pfad jedes gemounteten Archivs in einer Liste gespeichert. Beim Beenden der Applikation iteriert die Applikation über jeden Pfad in der Liste unmountet das Archiv und löscht den Ordner. Somit befindet sich das System wieder im gleichen Zustand wie vor dem Start der Applikation.</p>
<h2 id="delete">5.8 Delete</h2>
<p>Soll ein Archiv gelöscht werden wird, wie bei der „Restore“ und „Mount“ Funktion, überprüft ob eines angewählt ist. Ist dies gegeben, zeigt die Applikation dem Benutzer einen Dialog, Abbildung:(28). Bestätigt er diesen mit „Yes“ wird der Vorgang fortgesetzt und das Archiv gelöscht mit „No“ wird der Vorgang abgebrochen. Nach der Löschung werden die Archivliste und die Repository Statistik aktualisiert, um den neuen Zustand wiederzugeben.</p>
<p><a href="file:pictures/borgqt_yes_no.png" class="uri">file:pictures/borgqt_yes_no.png</a></p>
<h2 id="automatische-backups">5.9 Automatische Backups</h2>
<p>Damit der Benutzer die Backups nicht von Hand machen muss, ist es sinnvoll eine Funktion bereitzustellen, welche die Backups automatisch im Hintergrund erledigt. Dadurch ist sichergestellt das die Backups im allgemeinen Trubel des Lebens nicht vergessen gehen.</p>
<p>Voraussetzung für automatisierte Backups ist, dass die Datensicherung ohne gui gestartet werden kann. Bei Borg-Qt wird dies über einen Kommandozeilen Parameter realisiert. Hierfür wurde das Python Standard Paket <code>argparser</code> verwendet. Konkret bedeutet dies, dass wenn die Applikation auf der Kommandozeile mit folgendem Befehl ausgeführt wird: <code>borg_qt -B</code>. Wird die grafische Oberfläche nicht angezeigt und es wird direkt die Methode <code>background_backup</code> der Klasse <code>MainWindow</code> ausgeführt. Dabei werden alle Ordner, welche in den Einstellungen unter „Include“ sowie „Exclude“ gespeichert wurden, im Archiv gesichert, respektive davon ausgeschlossen. Damit sind die Voraussetzungen für automatische Backups gegeben.</p>
<p>Um die Backups in regelmässigen Intervallen auszuführen, gibt es zwei Möglichkeiten, wie man dies implementieren könnte.</p>
<p>Variante a), die Applikation permanent im Hintergrund laufen lassen, etwa als Trayicon wie man das von anderen Applikationen wie etwas Dropbox kennt.</p>
<p>Variante b) über Werkzeuge des Betriebssystems. Die drei Desktop Betriebsysteme, Windows, OS X und Linux bringen alle drei Werkzeuge mit, um periodisch ein Programm auszuführen.</p>
<p>Für Borg-Qt wurde beschlossen Variante b) zu realisieren. Die Anwendung soll dem Benutzer soweit als möglich aus dem Weg gehen. Eine Anwendung welche permanent in der Taskleiste lebt, erfüllt das Kriterum nicht.</p>
<p>Unter Linux wurden sich wiederholende Aufgaben, früher mit sogenannten Cron Jobs umgesetzt. Die moderne Lösung sind heutzutage jedoch Systemd Timer. Also konkret Systemd. Dies aus dem Grund das Systemd genau für das Managen von Systemdiensten programmiert wurde. Ein Grossteil der benötigten Funktion ist bereits in Systemd enthalten, somit kann bei der Entwicklung zusätzlich Zeit gespart werden.</p>
<p>Systemd ist ein init System, welches dazu dient dazu die Benutzerumgebung und die dazugehörigen Prozesse zu starten und zu verwalten [systemd]. Die Prozesse werden über sogenannte „Services“ gestartet. Die Services werden dabei einfach in Klartextdateien mit der Dateiendung <code>.service</code> definiert. Der Inhalt orientiert sich dabei praktischerweise am „INI“ Stil. In Borg-Qt wurde das INI Format bereits bei den Konfigurationsdateien verwendet. Somit können die dort gesammelte Erfahrungen zur Implementation von <code>configparser</code> wiederverwendet werden. Soll ein Service in einem gewissen Zeitintervall ausgeführt werden, benötigt Systemd eine weitere Datei mit dem gleichen Namen jedoch mit der Dateiendung <code>.timer</code> . Der Inhalt ist auch wieder im INI Stil gehalten. Systemd versteht eine Vielzahl an Datumsformaten [systemddate]. In Borg-Qt wurden zwei Varianten in den Einstellungen umgesetzt. Eine, welche „Predefined Schedule“ genannt wurde und eine mit dem Namen „Custom Schedule“, zu sehen in, Abbildung:(29). Die Predefined Option wird dabei in die von Systemd unterstützten Formate „hourly, daily, weekly und monthly“ übersetzt. Entsprechend der gewählten Wiederholung wird automatisch ein Archiv erstellt. Mit der Custom Option kann der Benutzer sich den Zeitplan individueller gestalten. Etwa „jeden Mittwoch um 12:00 Uhr“ für Systemd übersetzt würde dieser Zeitplan dann so aussehen: <code>Wednesday *-*-* 12:00:00</code>. Für spätere Versionen von Borg-Qt wäre es allenfalls auch möglich die Auswahl von mehreren Wochentagen zu ermöglichen, damit der Benutzer etwa folgenden Zeitplan erstellen könnte „Montag, Mittwoch, Freitag stündliche Backups.“ (<code>Monday, Wednesday, Friday *-*-* *:00:00</code>).</p>
<p><a href="file:pictures/borgqt_settings_schedule.png" class="uri">file:pictures/borgqt_settings_schedule.png</a></p>
<p>Das Erstellen der eigentlichen Systemd Konfiguration passiert in Borg-Qt in der <code>Config</code> Klasse zum gleichen Zeitpunkt, wie die eigentliche Konfigurationsdatei geschrieben wird. Zum Schreiben und de-/aktivieren des Systemd Services, respektive Timers wurde eine Klasse <code>SystemdFile</code> erstellt. Somit könnte die Funktion auch einfach in einem anderen Projekt verwendet werden.</p>
<p>Systemd benötigt zum Starten der Anwendung den absoluten Pfad in der Service Datei. Da davon ausgegangen werden kann, das Borg-Qt im <code>PATH</code> des Systems abgelegt wird, wurde das Unix Tool <code>which</code> verwendet, um den exakten Speicherort zu erhalten. Mittels des Befehls <code>which borg-qt</code> erhält man den absoluten Speicherort der Datei. Zusammen mit den Daten aus den Einstellungen wird diese Information in einem <code>Configparser</code> Objekt gespeichert, welches dann mithilfe der <code>SystemdFile</code> Klasse in eine <code>borg_qt.service</code>, Codesnippet:(8), respektive <code>borg_qt.timer</code>, Codesnippet:(9), Datei, im Systemd Pfad <code>/home/username/.config/systemd/user/</code> geschrieben und aktiviert wird.</p>
<p>Eine Option in der Datei <code>borg_qt.timer</code>, die noch erwähnenswert ist, ist <code>Persistent = true</code>. Ist <code>Persistent</code> auf <code>true</code> gesetzt, holt Systemd den Tasks nach sollte er eine Ausführung verpasst haben. Dies ist insbesondere dann hilfreich, wenn etwa der Zeitplan auf <code>daily</code> oder <code>weekly</code> gesetzt wurde. Sollte also etwa jeden Mittwoch ein Backup gemacht werden aber der Computer lief an diesem Tag nicht, startet Systemd Borg-Qt, sobald der Computer das nächste Mal eingeschaltet wird kommt.</p>
<pre><code> #~/.config/systemd/user/borg_qt.service
 [Unit]
 Description = Runs Borg-Qt once in the backround to take a backup according to the configuration.

 [Service]
 Type = oneshot
 ExecStart = /home/andreas/bin/borg_qt -B</code></pre>
<p>Programmlisting 8 Systemd Service Datei für Borg-Qt</p>
<pre><code> #~/.config/systemd/user/borg_qt.timer
 [Unit]
 Description = Starts the borg_qt.service according to the configured schedule.

 [Timer]
 OnCalendar = hourly
 Persistent = true

 [Install]
 WantedBy = timers.target</code></pre>
<p>Programmlisting 9 Systemd Timer Datei für Borg-Qt</p>
<h2 id="gui-anpassungen-nach-usability-studie">5.10 GUI Anpassungen nach Usability-Studie</h2>
<p>Im Rahmen der durchgeführten [Usability-Studie] machten die User folgenden Feststellungen: * „Include“ und „Exclude“ Funktionen sind unklar beschriftet. * Die Funktionen sind unklar. * Texte sind nicht einheitlich.</p>
<p>Die Korrekturen wurden im Rahmen der Diplomarbeit angepasst.</p>
<p>In den „Include“ sowie „Exclude“ Optionen wurden einige Buttons neu beschriftet und zwei Labels hinzugefügt, nun wird klarer auf ihre Funktion hingewiesen, Abbildungen:(30) und (31).</p>
<p><a href="file:pictures/borgqt_settings_include_v2.png" class="uri">file:pictures/borgqt_settings_include_v2.png</a></p>
<p><a href="file:pictures/borgqt_settings_exclude_v2.png" class="uri">file:pictures/borgqt_settings_exclude_v2.png</a></p>
<p>Um die Funktionen der Applikation zur erklären wurde ein Hilfe Fenster, Abbildung:(32), eingebaut. Dieses wird dem Benutzer beim Start der Applikation angezeigt. Es gibt ihm einen kurzen Überblick welcher Button welche Aktion auslöst und welche Elemente welche Information anzeigen. Optional kann der Benutzer entscheiden, dass er das Fenster beim nächsten Start nicht mehr angezeigt bekommen möchte. Über den Button „Help“ kann das Fenster jederzeit unabhängig der Einstellungen wieder angezeigt werden.</p>
<p><a href="file:pictures/borgqt_help.png" class="uri">file:pictures/borgqt_help.png</a></p>
<p>Mit Fertigstellung der Anpassungen wurde die Realisierung erfolgreich abgeschlossen und die Entwicklung neuer Funktionen für den Zeitrahmen der Diplomarbeit gestoppt.</p>
<p>[Usability-Studie] siehe Abschnitt 4.5</p>
<h2 id="releases">5.11 Releases</h2>
<p>Für die finale Veröffentlichung wird Borg-Qt als ein sogenanntes ausführbares „Binary“ zur Verfügung gestellt. Man kennt diese auf Windows Systemen etwa als die Dateien mit der Endung <code>.exe</code>. Beim Binary handelt es sich um ein selbst entpackendes Dateiarchiv. Sämtliche benötigten Python Module und sonstige Dateien wie etwa die Icons oder gui Definitionsdateien sind darin enthalten.</p>
<p>Diese Art der Auslieferung hat den Vorteil, dass der User das Programm nicht speziell installieren muss oder dafür irgendwelche zusätzlichen Dinge installieren muss. Der Nachteil ist jedoch, dass ein solches Binary nur auf dem jeweiligen Betriebssystem erstellt und ausgeführt werden kann. Das heisst, dass man unter Linux etwa keine Binaries für Mac erstellen kann oder umgekehrt.</p>
<p>Das Binary wird mit dem Programm „PyInstaller“[pyinstaller] erstellt. PyInstaller wird auf der Kommandozeile mit Angabe der Hauptdatei des Codes ausgeführt. Der Befehl dafür ist relativ einfach, Codesnippet:(10). Pfade zusätzlicher Dateien wie etwa Icons müssen mit angegeben werden. PyInstaller kann diese sonst nicht in das Binary einbinden. Der gezeigte Code wurde dabei in ein Makefile implementiert. Somit kann man in der obersten Ebene des Repository einfach den Befehl <code>make</code> ausführen und das Binary wird im Ordner <code>dist</code> erstellt.</p>
<pre><code> pyinstaller --hidden-import=PyQt5.sip \
     --add-data=borg_qt/static/icons:static/icons \
     --add-data=borg_qt/static/UI:static/UI \
     -F borg_qt/borg_qt.py; \</code></pre>
<p>Programmlisting 10 Code zum Erstellen der finalen Binaries von Borg-Qt</p>
<p>Auf Github wird jeweils ein Release erstellt und dazu die passenden Binaries hochgeladen. Github packt dabei den Source Code beim Erstellen des Releases in ein Zip Archiv. Somit steht der exakte Source Code zu jedem Binary direkt zu Verfügung. Dies um den Regeln der gpl zu folgen sowie um Benutzern die Möglichkeit zu geben den Code vor einer Nutzung zu überprüfen und als sicher zu befinden.</p>
<h2 id="kontrollieren-der-testfälle">5.12 Kontrollieren der Testfälle</h2>
<p>Am 25.02.2019 würden gemäss dem Zeitplan die Testfälle durchgegangen. Bis auf die Testfälle TC-18 und TC-24 konnten alle Testfälle erfolgreich durchgeführt werden. TC-18 und TC-24 konnten deshalb nicht durchgeführt werden, da diese Funktionen noch nicht implementiert wurden. TC-18 ist zwar technisch bereits möglich wurde im gui jedoch noch nicht umgesetzt. Die Resultate wurden in der Tabelle:(29) erfasst.</p>
<h1 id="ausblickfazit">6 Ausblick/Fazit</h1>
<h2 id="zielbewertung">6.1 Zielbewertung</h2>
<p>In der nachfolgenden Tabelle:(25) wurden die Ziele nach „Erfüllt“, „Nicht erfüllt“ oder „Teilweise erfüllt“ bewertet. Die Ziel-Nr. entspricht dabei der Ziel-Nr. in der Tabelle:(1). In der Spalte Bemerkung wird noch kurz ausgeführt, in welcher Form das Ziel bewiesen wurde.</p>
<h3 id="risikoanalyse-der-neuen-ist-situation">6.1.1 Risikoanalyse der neuen Ist-Situation</h3>
<p>Das Ist-Riskio in der Sektion [Risiko-Analyse] könnte wie prognostiziert erhehblich gesenkt werden. Entgegen der ursprünglichen Annahme konnten die automatischen Backups doch noch während der Diplomarbeit implementiert werden. Dadurch konnte auch das Risiko Nr. 5 (Der Benutzer vergisst Backups zu machen) erheblich gesenkt werden. Somit hat die neue Ist-Situation, Abbildung:(33), eine bessere Risikobewertung als das geplante [Soll-Risiko].</p>
<p><a href="file:pictures/ist_risiko_neu.pdf" class="uri">file:pictures/ist_risiko_neu.pdf</a></p>
<p>[Risiko-Analyse] siehe Abschnitt 3.3</p>
<p>[Soll-Risiko] See figure 5</p>
<h2 id="projektmanagement">6.2 Projektmanagement</h2>
<p>Das zu Beginn erstellte Gantt Chart war sehr hilfreich, um den Überblick über das Projekt zu behalten. Anhand davon konnte immer abgeschätzt werden wie das Projekt etwa im Zeitplan steht. Durch die Annahme das an arbeitsfreien Tagen nur 6 Stunden gearbeitet wird, konnte unter der Woche auch mal ein Abend ausgesetzt werden, wenn am Wochenende zuvor einmal 8 Stunden gearbeitet wurde.</p>
<p>Die regelmässigen Arbeitsessions an jedem schulfreien Samstag und an den freien Montagen haben sich als eine gute Variante des Arbeiten erwiesen und haben die Last der Diplomarbeit gut verteilt.</p>
<p>Die konservativen Zeitschätzungen haben sich als korrekte Entscheidung erwiesen. In Zukunft kann noch stärker versucht werden die Zeit, welche für ähnliche Code Teile verwendet wird kürzer zu schätzen. Copy/Paste erlaubt unter Umständen enorme Zeitersparnise. Trotzdem sollte genügend Reserve für allfällige Herausforderungen eingeplant werden. In der Entwicklung kann es immer wieder vorkommen das man an einem Bug oder Ähnlichem hängen bleibt ohne das man es mit mehr Arbeitskräften oder Zeit schneller beheben kann.</p>
<p>Für die Planung der Programmierarbeiten haben sie die Use Cases und Aktivitätsdiagramme als eine grosse Hilfe erwiesen. Besonders um den roten Faden während der Entwicklung zu behalten waren sie sehr hilfreich.</p>
<h3 id="zeitaufwand-1">6.2.1 Zeitaufwand</h3>
<p>Der Zeitaufwand ist wie in Tabelle:(28) zu sehen, leicht tiefer als geplant. Dies ist vor allem auf die Zeitersparnisse bei der Realisierung zurückzuführen.</p>
<h3 id="ressourcen-1">6.2.2 Ressourcen</h3>
<p>Die im Projekt eingesetzten Ressourcen entsprechen den in der Tabelle:(26) geplanten 1:1.</p>
<h3 id="kosten-1">6.2.3 Kosten</h3>
<p>Da die geleisteten Stunden tiefer als geplant waren, sind auch die geschätzten Kosten tiefer. Wie in der Tabelle:(27) zu sehen würden sich die angenommenen, internen Kosten für die Arbeit auf ca. 17302.20 CHF belaufen. Dies stellt eine Einsparung von 1777.8 CHF dar.</p>
<h2 id="usability-studie-1">6.3 Usability-Studie</h2>
<p>Die Studie war eine sehr interessante Erfahrung. Enduser sehen eine Anwendung mit ganz anderen Augen als der Entwickler der Anwendung. Dieser weiss von jedem Element wie der Code dazu aussieht. Es wurde auch klar, dass die Aufgaben in einer Studie richtig gestellt werden müssen. Ansonsten wissen die Probanden schon gar nicht erst was von ihnen gefordert wird.</p>
<p>Auch sollte, wenn möglich, darauf geachtet werden, dass auf einem Betriebssystem getestet mit welchem die Probanden bereits etwas Erfahrung haben. Zwei der Probanden waren ab dem Verhalten und Aussehen des Dateimanagers von Ubuntu 18.04 etwas verwirrt. Sie hatten ihn zuvor weder gesehen noch genutzt. Alternativ könnte auch die Gruppe der Probanden so gewählt werden, dass sie mit dem Betriebssystem bereits vertraut sind.</p>
<p>Eine Usability-Studie ist auf jeden Fall etwas, was man bei zukünftigen Software Projekten, wieder machten sollte.</p>
<h2 id="umsetzung">6.4 Umsetzung</h2>
<p>Die Entwicklung mit Qt und Python ging sehr gut von der Hand. Die grafische Erstellung des gui mit dem Qt Designer war sehr hilfreich und hat es ermöglicht mit den Elementen auch einfach mal zu spielen, um zu sehen was passt und was eher weniger geht. Qt selbst ist ein gutes und sehr umfangreiches Framework. Das die Dokumentation den Fokus hauptsächlich auf C++ Code hat, machte es einem zu Beginn etwas schwieriger die gewünschte Information zu finden.</p>
<p>Python als Programmiersprache hat sich in der Entwicklung als gute Entscheidung bewährt. Die Entwicklung ging schnell und unkompliziert von der Hand. Python wurde, als eine sehr flexible Sprache wahrgenommen die einem bei der Entwicklung aus dem Weg geht.</p>
<p>Die eingesetzten unittest waren hilfreiche Werkzeuge bei der Entwicklung. Gegen Ende der Entwicklung wurden sie jedoch weniger eingesetzt da die Entwicklung davon doch etwas Zeit beansprucht und auch ein gewisses Mass an Erfahrung. Wenn man zuerst noch Recherchieren muss wie man den unittest schreibt verliert man wertvolle Zeit die man, während einer Diplomarbeit nicht zur Verfügung hat.</p>
<p>Diejenigen Tests die jedoch geschrieben wurden haben sich, als sehr hilfreich erwiesen einem ein Art Sicherheitsnetz zu bieten in dem sie aufgezeigt haben das nach einer grösseren Änderung immer noch alles so funktionert, wie es sollte. Es ist schade das unittest an der IBZ nicht gelehrt wurden. Sie scheinen definitiv etwas zu sein was jeder Programmierer beherrschen sollte und die Grundlagen für jedes Projekt, das über ein paar Zeilen hinausgeht, sein sollten. unittest werden mit Sicherheit eines der Hauptthemen zum Lernen in den nächsten paar Monaten sein.</p>
<h2 id="weiterverwendung-von-borg-qt">6.5 Weiterverwendung von Borg-Qt</h2>
<p>Borg-Qt wird als Freizeitprojekt des Projektleiters weiter geführt. Ein paar der Kann-Ziele wären noch sehr nützlich wären sie in der Applikation integriert. Zudem sind ein paar davon interessante Aufgaben um die eigenen Fähigkeiten zu erweitern. Nach Abschluss der Diplomarbeit wird die Entwicklung der Anwendung dann auch für Externe geöffnet. Vonseiten der borg Community kam zum Zeitpunkt der Arbeit noch kein spezifisches Feedback zurück. Die Hoffnung besteht, dass sich allenfalls noch ein, zwei Interessierte finden, um am Projekt mitzuarbeiten.</p>
<p>Die Applikation wird aber auf jeden Fall vom Projektleiter produktiv eingesetzt, um seine sowie teilweise auch die Daten von Bekannten zu sichern.</p>
<h1 id="anhang">7 Anhang</h1>
<h2 id="ressourcen-2">7.1 Ressourcen</h2>
<h2 id="kosten-2">7.2 Kosten</h2>
<h2 id="zeitaufwand-2">7.3 Zeitaufwand</h2>
<h2 id="testfälle">7.4 Testfälle</h2>
<h2 id="meeting-protokolle">7.7 Meeting Protokolle</h2>
<p>Die Meeting Protokolle sind in der Datei [03_Meeting_Protokolle.pdf] zu finden.</p>
<p>[03_Meeting_Protokolle.pdf] <a href="file:03_Meeting_Protokolle.pdf" class="uri">file:03_Meeting_Protokolle.pdf</a></p>
<h2 id="references" class="page_break_before">References</h2>
<!-- Explicitly insert bibliography here -->
<div id="refs" role="doc-bibliography">

</div>
<!-- default theme -->

<style>
    /* import google fonts */
    @import url("https://fonts.googleapis.com/css?family=Alegreya:400,600,700");
    @import url("https://fonts.googleapis.com/css?family=Source+Code+Pro");

    /* -------------------------------------------------- */
    /* global */
    /* -------------------------------------------------- */

    /* all elements */
    * {
        /* force sans-serif font unless specified otherwise */
        font-family: "Alegreya", serif;

        /* prevent text inflation on some mobile browsers */
        -webkit-text-size-adjust: none !important;
        -moz-text-size-adjust: none !important;
        -o-text-size-adjust: none !important;
        text-size-adjust: none !important;
    }

    @media only screen {
        /* "page" element */
        body {
            position: relative;
            box-sizing: border-box;
            font-size: 12pt;
            line-height: 1.5;
            max-width: 8.5in;
            margin: 20px auto;
            padding: 40px;
            border-radius: 5px;
            border: solid 1px #bdbdbd;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            background: #ffffff;
        }
    }

    /* when on screen < 8.5in wide */
    @media only screen and (max-width: 8.5in) {
        /* "page" element */
        body {
            padding: 20px;
            margin: 0;
            border-radius: 0;
            border: none;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05) inset;
            background: none;
        }
    }

    /* -------------------------------------------------- */
    /* headings */
    /* -------------------------------------------------- */

    /* all headings */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 20px 0;
        padding: 0;
        font-weight: bold;
    }

    /* biggest heading */
    h1 {
        margin: 40px 0;
        text-align: center;
    }

    /* second biggest heading */
    h2 {
        margin-top: 30px;
        padding-bottom: 5px;
        border-bottom: solid 1px #bdbdbd;
    }

    /* -------------------------------------------------- */
    /* manuscript header */
    /* -------------------------------------------------- */

    /* manuscript title */
    header > h1 {
        margin: 0;
    }

    /* manuscript title caption text (ie "automatically generated on") */
    header + p {
        text-align: center;
        margin-top: 10px;
    }

    /* -------------------------------------------------- */
    /* text elements */
    /* -------------------------------------------------- */

    /* links */
    a {
        color: #2196f3;
        overflow-wrap: break-word;
    }

    /* normal links (not empty, not button link, not syntax highlighting link) */
    a:not(:empty):not(.button):not(.sourceLine) {
        padding-left: 1px;
        padding-right: 1px;
    }

    /* superscripts and subscripts */
    sub,
    sup {
        /* prevent from affecting line height */
        line-height: 0;
    }

    /* unordered and ordered lists*/
    ul,
    ol {
        padding-left: 20px;
    }

    /* class for styling text semibold */
    .semibold {
        font-weight: 600;
    }

    /* class for styling elements horizontally left aligned */
    .left {
        display: block;
        text-align: left;
        margin-left: auto;
        margin-right: 0;
        justify-content: left;
    }

    /* class for styling elements horizontally centered */
    .center {
        display: block;
        text-align: center;
        margin-left: auto;
        margin-right: auto;
        justify-content: center;
    }

    /* class for styling elements horizontally right aligned */
    .right {
        display: block;
        text-align: right;
        margin-left: 0;
        margin-right: auto;
        justify-content: right;
    }

    /* -------------------------------------------------- */
    /* section elements */
    /* -------------------------------------------------- */

    /* horizontal divider line */
    hr {
        border: none;
        height: 1px;
        background: #bdbdbd;
    }

    /* paragraphs, horizontal dividers, figures, tables, code */
    p,
    hr,
    figure,
    table,
    pre {
        /* treat all as "paragraphs", with consistent vertical margins */
        margin-top: 20px;
        margin-bottom: 20px;
    }

    /* -------------------------------------------------- */
    /* figures */
    /* -------------------------------------------------- */

    /* figure */
    figure {
        max-width: 100%;
        margin-left: auto;
        margin-right: auto;
    }

    /* figure caption */
    figcaption {
        padding: 0;
        padding-top: 10px;
    }

    /* figure image element */
    figure img {
        max-width: 100%;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    /* figure auto-number */
    img + figcaption > span:first-of-type {
        font-weight: bold;
        margin-right: 5px;
    }

    /* -------------------------------------------------- */
    /* tables */
    /* -------------------------------------------------- */

    /* table */
    table {
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        margin-left: auto;
        margin-right: auto;
    }

    /* table cells */
    th,
    td {
        border: solid 1px #bdbdbd;
        padding: 10px;
        /* squash table if too wide for page by forcing line breaks */
        overflow-wrap: break-word;
        word-break: break-word;
    }

    /* header row and even rows */
    th,
    tr:nth-child(2n) {
        background-color: #fafafa;
    }

    /* odd rows */
    tr:nth-child(2n + 1) {
        background-color: #ffffff;
    }

    /* table caption */
    caption {
        text-align: left;
        padding: 0;
        padding-bottom: 10px;
    }

    /* table auto-number */
    table > caption > span:first-of-type,
    div.table_wrapper > table > caption > span:first-of-type {
        font-weight: bold;
        margin-right: 5px;
    }

    /* -------------------------------------------------- */
    /* code */
    /* -------------------------------------------------- */

    /* multi-line code block */
    pre {
        padding: 10px;
        background-color: #eeeeee;
        color: #000000;
        border-radius: 5px;
        break-inside: avoid;
        text-align: left;
    }

    /* inline code, ie code within normal text */
    :not(pre) > code {
        padding: 0 4px;
        background-color: #eeeeee;
        color: #000000;
        border-radius: 5px;
    }

    /* code text */
    /* apply all children, to reach syntax highlighting sub-elements */
    code,
    code * {
        /* force monospace font */
        font-family: "Source Code Pro", "Courier New", monospace;
    }

    /* -------------------------------------------------- */
    /* quotes */
    /* -------------------------------------------------- */

    /* quoted text */
    blockquote {
        margin: 0;
        padding: 0;
        border-left: 4px solid #bdbdbd;
        padding-left: 16px;
        break-inside: avoid;
    }

    /* -------------------------------------------------- */
    /* banners */
    /* -------------------------------------------------- */

    /* info banners */
    .banner {
        box-sizing: border-box;
        display: block;
        position: relative;
        width: 100%;
        margin-top: 20px;
        margin-bottom: 20px;
        padding: 20px;
        text-align: center;
    }

    /* paragraph in banner */
    .banner > p {
        margin: 0;
    }

    /* -------------------------------------------------- */
    /* highlight colors */
    /* -------------------------------------------------- */

    .white {
        background: #ffffff;
    }
    .lightgrey {
        background: #eeeeee;
    }
    .grey {
        background: #757575;
    }
    .darkgrey {
        background: #424242;
    }
    .black {
        background: #000000;
    }
    .lightred {
        background: #ffcdd2;
    }
    .lightyellow {
        background: #ffecb3;
    }
    .lightgreen {
        background: #dcedc8;
    }
    .lightblue {
        background: #e3f2fd;
    }
    .lightpurple {
        background: #f3e5f5;
    }
    .red {
        background: #f44336;
    }
    .orange {
        background: #ff9800;
    }
    .yellow {
        background: #ffeb3b;
    }
    .green {
        background: #4caf50;
    }
    .blue {
        background: #2196f3;
    }
    .purple {
        background: #9c27b0;
    }
    .white,
    .lightgrey,
    .lightred,
    .lightyellow,
    .lightgreen,
    .lightblue,
    .lightpurple,
    .orange,
    .yellow,
    .white a,
    .lightgrey a,
    .lightred a,
    .lightyellow a,
    .lightgreen a,
    .lightblue a,
    .lightpurple a,
    .orange a,
    .yellow a {
        color: #000000;
    }
    .grey,
    .darkgrey,
    .black,
    .red,
    .green,
    .blue,
    .purple,
    .grey a,
    .darkgrey a,
    .black a,
    .red a,
    .green a,
    .blue a,
    .purple a {
        color: #ffffff;
    }

    /* -------------------------------------------------- */
    /* buttons */
    /* -------------------------------------------------- */

    /* class for styling links like buttons */
    .button {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        margin: 5px;
        padding: 10px 20px;
        font-size: 0.75em;
        font-weight: 600;
        text-transform: uppercase;
        text-decoration: none;
        letter-spacing: 1px;
        background: none;
        color: #2196f3;
        border: solid 1px #bdbdbd;
        border-radius: 5px;
    }

    /* buttons when hovered */
    .button:hover:not([disabled]),
    .icon_button:hover:not([disabled]) {
        cursor: pointer;
        background: #f5f5f5;
    }

    /* buttons when disabled */
    .button[disabled],
    .icon_button[disabled] {
        opacity: 0.35;
        pointer-events: none;
    }

    /* class for styling buttons containg only single icon */
    .icon_button {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        text-decoration: none;
        margin: 0;
        padding: 0;
        background: none;
        border-radius: 5px;
        border: none;
        width: 20px;
        height: 20px;
        min-width: 20px;
        min-height: 20px;
    }

    /* icon button inner svg image */
    .icon_button > svg {
        height: 16px;
    }

    /* -------------------------------------------------- */
    /* icons */
    /* -------------------------------------------------- */

    /* class for styling icons inline with text */
    .inline_icon {
        height: 1em;
        position: relative;
        top: 0.125em;
    }

    /* -------------------------------------------------- */
    /* print control */
    /* -------------------------------------------------- */

    @media print {
        @page {
            /* suggested printing margin */
            margin: 1in;
        @bottom-right{
            content: counter(page) " of " counter(pages);
            }
        }

        /* document and "page" elements */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        /* "page" element */
        body {
            font-size: 11pt !important;
            line-height: 1.35;
        }

        /* all headings */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 15px 0;
        }

        /* heading 1 */
        h1 {
            font-size: 1.75em;
        }

        /* heading 2 */
        h2 {
            font-size: 1.25em;
            margin-top: 0;
        }

        /* heading 3 */
        h3 {
            font-size: 1.10em;
        }

        /* figures and tables */
        figure, table {
            font-size: 0.85em;
        }

        /* table cells */
        th,
        td {
            padding: 5px;
        }

        /* shrink font awesome icons */
        i.fas,
        i.fab,
        i.far,
        i.fal {
            transform: scale(0.85);
        }

        /* decrease banner margins */
        .banner {
            margin-top: 15px;
            margin-bottom: 15px;
            padding: 15px;
        }

        /* class for centering an element vertically on its own page */
        .page_center {
            margin: auto;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            vertical-align: middle;
            break-before: page;
            break-after: page;
        }

        /* always insert a page break before the element */
        .page_break_before {
            break-before: page;
        }

        /* always insert a page break after the element */
        .page_break_after {
            break-after: page;
        }

        /* avoid page break before the element */
        .page_break_before_avoid {
            break-before: avoid;
        }

        /* avoid page break after the element */
        .page_break_after_avoid {
            break-after: avoid;
        }

        /* avoid page break inside the element */
        .page_break_inside_avoid {
            break-inside: avoid;
        }
    }

    /* -------------------------------------------------- */
    /* override pandoc css quirks */
    /* -------------------------------------------------- */

    .sourceCode {
        /* prevent unsightly overflow in wide code blocks */
        overflow: auto !important;
    }

    div.sourceCode {
        /* prevent background fill on top-most code block  container */
        background: none !important;
    }

    .sourceCode * {
        /* force consistent line spacing */
        line-height: 1.5 !important;
    }

    div.sourceCode {
        /* style code block margins same as <pre> element */
        margin-top: 20px;
        margin-bottom: 20px;
    }

    /* -------------------------------------------------- */
    /* tablenos */
    /* -------------------------------------------------- */

    /* tablenos wrapper */
    .tablenos {
        /* show scrollbar on tables if necessary to prevent overflow */
        width: 100%;
        margin: 20px 0;
    }

    .tablenos > table {
        /* move margins from table to table_wrapper to allow margin collapsing */
        margin: 0;
    }

    @media only screen {
        /* tablenos wrapper */
        .tablenos {
            /* show scrollbar on tables if necessary to prevent overflow */
            overflow-x: auto !important;
        }

        .tablenos th,
        .tablenos td {
            overflow-wrap: unset !important;
            word-break: unset !important;
        }

        /* table in wrapper */
        .tablenos table,
        .tablenos table * {
            /* don't break table words */
            overflow-wrap: normal !important;
        }
    }

    /* -------------------------------------------------- */
    /* mathjax */
    /* -------------------------------------------------- */

    /* mathjax containers */
    .math.display > span:not(.MathJax_Preview) {
        /* turn inline element (no dimensions) into block (allows fixed width and thus scrolling) */
        display: flex !important;
        overflow-x: auto !important;
        overflow-y: hidden !important;
        justify-content: center;
        align-items: center;
        margin: 0 !important;
    }

    /* right click menu */
    .MathJax_Menu {
        border-radius: 5px !important;
        border: solid 1px #bdbdbd !important;
        box-shadow: none !important;
    }

    /* equation auto-number */
    span[id^="eq:"] > span.math.display + span {
        font-weight: 600;
    }

    /* equation */
    span[id^="eq:"] > span.math.display > span {
        /* nudge to make room for equation auto-number and anchor */
        margin-right: 60px !important;
    }

    /* -------------------------------------------------- */
    /* anchors plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* anchor button */
        .anchor {
            opacity: 0;
            margin-left: 5px;
        }

        /* anchor buttons within <h2>'s */
        h2 .anchor {
            margin-left: 10px;
        }

        /* anchor buttons when hovered/focused and anything containing an anchor button when hovered */
        *:hover > .anchor,
        .anchor:hover,
        .anchor:focus {
            opacity: 1;
        }

        /* anchor button when hovered */
        .anchor:hover {
            cursor: pointer;
        }
    }

    /* always show anchor button on devices with no mouse/hover ability */
    @media (hover: none) {
        .anchor {
            opacity: 1;
        }
    }

    /* always hide anchor button on print */
    @media only print {
        .anchor {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* accordion plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* accordion arrow button */
        .accordion_arrow {
            margin-right: 10px;
        }

        /* arrow icon when <h2> data-collapsed attribute true */
        h2[data-collapsed="true"] > .accordion_arrow > svg {
            transform: rotate(-90deg);
        }

        /* all elements (except <h2>'s) when data-collapsed attribute true */
        *:not(h2)[data-collapsed="true"] {
            display: none;
        }

        /* accordion arrow button when hovered and <h2>'s when hovered */
        .accordion_arrow:hover,
        h2[data-collapsed="true"]:hover,
        h2[data-collapsed="false"]:hover {
            cursor: pointer;
        }
    }

    /* always hide accordion arrow button on print */
    @media only print {
        .accordion_arrow {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* tooltips plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* tooltip container */
        #tooltip {
            position: absolute;
            width: 50%;
            min-width: 240px;
            max-width: 75%;
            z-index: 1;
        }

        /* tooltip content */
        #tooltip_content {
            margin-bottom: 5px;
            padding: 20px;
            border-radius: 5px;
            border: solid 1px #bdbdbd;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            background: #ffffff;
            overflow-wrap: break-word;
        }

        /* tooltip copy of paragraphs and figures */
        #tooltip_content > p,
        #tooltip_content > figure {
            margin: 0;
            max-height: 320px;
            overflow-y: auto;
        }

        /* tooltip copy of <img> */
        #tooltip_content > figure > img {
            max-height: 260px;
        }

        /* navigation bar */
        #tooltip_nav_bar {
            margin-top: 10px;
            text-align: center;
        }

        /* navigation bar previous/next buton */
        #tooltip_nav_bar > .icon_button {
            position: relative;
            top: 3px;
        }

        /* navigation bar previous button */
        #tooltip_nav_bar > .icon_button:first-of-type {
            margin-right: 5px;
        }

        /* navigation bar next button */
        #tooltip_nav_bar > .icon_button:last-of-type {
            margin-left: 5px;
        }
    }

    /* always hide tooltip on print */
    @media only print {
        #tooltip {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* jump to first plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* jump button */
        .jump_arrow {
            position: relative;
            top: 0.125em;
            margin-right: 5px;
        }
    }

    /* always hide jump button on print */
    @media only print {
        .jump_arrow {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* link highlight plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* anything with data-highlighted attribute true */
        [data-highlighted="true"] {
            background: #ffeb3b;
        }

        /* anything with data-selected attribute true */
        [data-selected="true"] {
            background: #ff8a65 !important;
        }

        /* animation definition for glow */
        @keyframes highlight_glow {
            0% {
                background: none;
            }
            10% {
                background: #bbdefb;
            }
            100% {
                background: none;
            }
        }

        /* anything with data-glow attribute true */
        [data-glow="true"] {
            animation: highlight_glow 2s;
        }
    }

    /* -------------------------------------------------- */
    /* table of contents plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* toc panel */
        #toc_panel {
            box-sizing: border-box;
            position: fixed;
            top: 0;
            left: 0;
            background: #ffffff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            z-index: 2;
        }

        /* toc panel when closed */
        #toc_panel[data-open="false"] {
            min-width: 60px;
            width: 60px;
            height: 60px;
            border-right: solid 1px #bdbdbd;
            border-bottom: solid 1px #bdbdbd;
        }

        /* toc panel when open */
        #toc_panel[data-open="true"] {
            min-width: 260px;
            max-width: 480px;
            /* keep panel edge consistent distance away from "page" edge */
            width: calc(((100vw - 8.5in) / 2) - 30px - 40px);
            bottom: 0;
            border-right: solid 1px #bdbdbd;
        }

        /* toc panel header */
        #toc_header {
            box-sizing: border-box;
            display: flex;
            flex-direction: row;
            align-items: center;
            height: 60px;
            margin: 0;
            padding: 20px;
        }

        /* toc panel header when hovered */
        #toc_header:hover {
            cursor: pointer;
        }

        /* toc panel header when panel open */
        #toc_panel[data-open="true"] > #toc_header {
            border-bottom: solid 1px #bdbdbd;
        }

        /* toc open/close header button */
        #toc_button {
            margin-right: 20px;
        }

        /* hide toc list and header text when closed */
        #toc_panel[data-open="false"] > #toc_header > *:not(#toc_button),
        #toc_panel[data-open="false"] > #toc_list {
            display: none;
        }

        /* toc list of entries */
        #toc_list {
            box-sizing: border-box;
            width: 100%;
            padding: 20px;
            position: absolute;
            top: calc(60px + 1px);
            bottom: 0;
            overflow: auto;
        }

        /* toc entry, link to section in document */
        .toc_link {
            display: block;
            padding: 5px;
            position: relative;
            font-weight: 600;
            text-decoration: none;
        }

        /* toc entry when hovered or when "viewed" */
        .toc_link:hover,
        .toc_link[data-viewing="true"] {
            background: #f5f5f5;
        }

        /* toc entry, level 1 indentation */
        .toc_link[data-level="1"] {
            margin-left: 0;
        }

        /* toc entry, level 2 indentation */
        .toc_link[data-level="2"] {
            margin-left: 20px;
        }

        /* toc entry, level 3 indentation */
        .toc_link[data-level="3"] {
            margin-left: 40px;
        }

        /* toc entry, level 4 indentation */
        .toc_link[data-level="4"] {
            margin-left: 60px;
        }

        /* toc entry bullets */
        #toc_panel[data-bullets="true"] .toc_link[data-level]:before {
            position: absolute;
            left: -15px;
            top: -1px;
            font-size: 1.5em;
        }

        /* toc entry, level 2 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="2"]:before {
            content: "\2022";
        }

        /* toc entry, level 3 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="3"]:before {
            content: "\25AB";
        }

        /* toc entry, level 4 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="4"]:before {
            content: "-";
        }
    }

    /* when on screen < 8.5in wide */
    @media only screen and (max-width: 8.5in) {
        /* push <body> ("page") element down to make room for toc icon */
        .toc_body_nudge {
            padding-top: 60px;
        }

        /* toc icon when panel closed and not hovered */
        #toc_panel[data-open="false"]:not(:hover) {
            background: rgba(255, 255, 255, 0.75);
        }
    }

    /* always hide toc panel on print */
    @media only print {
        #toc_panel {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* lightbox plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* regular <img> in document when hovered */
        .lightbox_document_img:hover {
            cursor: pointer;
        }

        .body_no_scroll {
            overflow: hidden !important;
        }

        /* screen overlay */
        #lightbox_overlay {
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            z-index: 3;
        }

        /* middle area containing lightbox image */
        #lightbox_image_container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            padding: 20px;
        }

        /* bottom area containing caption */
        #lightbox_bottom_container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            min-height: 100px;
            max-height: 100px;
            background: rgba(0, 0, 0, 0.5);
        }

        /* image number info text box */
        #lightbox_number_info {
            position: absolute;
            color: #ffffff;
            font-weight: 600;
            left: 2px;
            top: 0;
            z-index: 4;
        }

        /* zoom info text box */
        #lightbox_zoom_info {
            position: absolute;
            color: #ffffff;
            font-weight: 600;
            right: 2px;
            top: 0;
            z-index: 4;
        }

        /* copy of image caption */
        #lightbox_caption {
            box-sizing: border-box;
            display: inline-block;
            width: 100%;
            max-height: 100%;
            padding: 10px 0;
            text-align: center;
            overflow-y: auto;
            color: #ffffff;
        }

        /* navigation previous/next button */
        .lightbox_button {
            width: 100px;
            height: 100%;
            min-width: 100px;
            min-height: 100%;
            color: #ffffff;
        }

        /* navigation previous/next button when hovered */
        .lightbox_button:hover {
            background: none !important;
        }

        /* navigation button icon */
        .lightbox_button > svg {
            height: 25px;
        }

        /* figure auto-number */
        #lightbox_caption > span:first-of-type {
            font-weight: bold;
            margin-right: 5px;
        }

        /* lightbox image when hovered */
        #lightbox_img:hover {
            cursor: grab;
        }

        /* lightbox image when grabbed */
        #lightbox_img:active {
            cursor: grabbing;
        }
    }

    /* when on screen < 480px wide */
    @media only screen and (max-width: 480px) {
        /* make navigation buttons skinnier on small screens to make more room for caption text */
        .lightbox_button {
            width: 50px;
            min-width: 50px;
        }
    }

    /* always hide lightbox on print */
    @media only print {
        #lightbox_overlay {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* hypothesis (annotations) plugin */
    /* -------------------------------------------------- */

    /* side panel */
    .annotator-frame {
        width: 280px !important;
        z-index: 0 !important;
    }

    /* match highlight color to rest of theme */
    .annotator-highlights-always-on .annotator-hl {
        background-color: #ffeb3b !important;
    }

    /* match focused color to rest of theme */
    .annotator-hl.annotator-hl-focused {
        background-color: #ff8a65 !important;
    }

    /* match bucket bar color to rest of theme */
    .annotator-bucket-bar {
        background: #f5f5f5 !important;
    }

    /* always hide toolbar and tooltip on print */
    @media only print {
        .annotator-frame {
            display: none !important;
        }

        hypothesis-adder {
            display: none !important;
        }
    }
</style>
<!-- anchors plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin adds an anchor next to each of a certain type
        // of element that provides a human-readable url to that specific
        // item/position in the document (eg "manuscript.html#abstract"). It
        // also makes it such that scrolling out of view of a target removes
        // its identifier from the url.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'anchors';

        // default plugin options
        const options = {
            // which types of elements to add anchors next to, in
            // "document.querySelector" format
            typesQuery: 'h1, h2, h3, [id^="fig:"], [id^="tbl:"], [id^="eq:"]',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // add anchor to each element of specified types
            const elements = document.querySelectorAll(options.typesQuery);
            for (const element of elements)
                addAnchor(element);

            // attach scroll listener to window
            window.addEventListener('scroll', onScroll);
        }

        // when window is scrolled
        function onScroll() {
            // if url has hash and user has scrolled out of view of hash
            // target, remove hash from url
            const tolerance = 100;
            const target = getHashTarget();
            if (target) {
                if (
                    target.getBoundingClientRect().top >
                        window.innerHeight + tolerance ||
                    target.getBoundingClientRect().bottom < 0 - tolerance
                )
                    history.pushState(null, null, ' ');
            }
        }

        // add anchor to element
        function addAnchor(element) {
            let addTo; // element to add anchor button to

            // if figure or table, modify withId and addTo to get expected
            // elements
            if (element.id.indexOf('fig:') === 0) {
                addTo = element.querySelector('figcaption');
            } else if (element.id.indexOf('tbl:') === 0) {
                addTo = element.querySelector('caption');
            } else if (element.id.indexOf('eq:') === 0) {
                addTo = element.querySelector('.eqnos-number');
            }

            addTo = addTo || element;
            const id = element.id || null;

            // do not add anchor if element doesn't have assigned id.
            // id is generated by pandoc and is assumed to be unique and
            // human-readable
            if (!id)
                return;

            // create anchor button
            const anchor = document.createElement('a');
            anchor.innerHTML = document.querySelector('.icon_link').innerHTML;
            anchor.title = 'Link to this part of the document';
            anchor.classList.add('icon_button', 'anchor');
            anchor.dataset.ignore = 'true';
            anchor.href = '#' + id;
            addTo.appendChild(anchor);
        }

        // get element that is target of link or url hash
        function getHashTarget() {
            const hash = window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            // if figure or table, modify target to get expected element
            if (id.indexOf('fig:') === 0)
                target = target.querySelector('figure');
            if (id.indexOf('tbl:') === 0)
                target = target.querySelector('table');

            return target;
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- link icon -->

<template class="icon_link">
    <!-- modified from: https://fontawesome.com/icons/link -->
    <svg width="16" height="16" viewBox="0 0 512 512">
        <path
            fill="currentColor"
            d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"
        ></path>
    </svg>
</template>
<!-- accordion plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin allows sections of content under <h2> headings
        // to be collapsible.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'accordion';

        // default plugin options
        const options = {
            // whether to always start expanded ('false'), always start
            // collapsed ('true'), or start collapsed when screen small ('auto')
            startCollapsed: 'auto',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // run through each <h2> heading
            const headings = document.querySelectorAll('h2');
            for (const heading of headings) {
                addArrow(heading);

                // start expanded/collapsed based on option
                if (
                    options.startCollapsed === 'true' ||
                    (options.startCollapsed === 'auto' && isSmallScreen())
                )
                    collapseHeading(heading);
                else
                    expandHeading(heading);
            }

            // attach hash change listener to window
            window.addEventListener('hashchange', onHashChange);
        }

        // when hash (eg manuscript.html#introduction) changes
        function onHashChange() {
            const target = getHashTarget();
            if (target)
                goToElement(target);
        }

        // add arrow to heading
        function addArrow(heading) {
            // add arrow button
            const arrow = document.createElement('button');
            arrow.innerHTML = document.querySelector(
                '.icon_angle_down'
            ).innerHTML;
            arrow.classList.add('icon_button', 'accordion_arrow');
            heading.insertBefore(arrow, heading.firstChild);

            // attach click listener to heading and button
            heading.addEventListener('click', onHeadingClick);
            arrow.addEventListener('click', onArrowClick);
        }

        // determine if on mobile-like device with small screen
        function isSmallScreen() {
            return Math.min(window.innerWidth, window.innerHeight) < 480;
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // get element that is target of hash
        function getHashTarget(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            // if figure or table, modify target to get expected element
            if (id.indexOf('fig:') === 0)
                target = target.querySelector('figure');
            if (id.indexOf('tbl:') === 0)
                target = target.querySelector('table');

            return target;
        }

        // when <h2> heading is clicked
        function onHeadingClick(event) {
            // only collapse if <h2> itself is target of click (eg, user did
            // not click on anchor within <h2>)
            if (event.target === this)
                toggleCollapse(this);
        }

        // when arrow button is clicked
        function onArrowClick() {
            toggleCollapse(this.parentNode);
        }

        // collapse section if expanded, expand if collapsed
        function toggleCollapse(heading) {
            if (heading.dataset.collapsed === 'false')
                collapseHeading(heading);
            else
                expandHeading(heading);
        }

        // elements to exclude from collapse, such as table of contents panel,
        // hypothesis panel, etc
        const exclude = '#toc_panel, div.annotator-frame, #lightbox_overlay';

        // collapse section
        function collapseHeading(heading) {
            heading.setAttribute('data-collapsed', 'true');
            const children = getChildren(heading);
            for (const child of children)
                child.setAttribute('data-collapsed', 'true');
        }

        // expand section
        function expandHeading(heading) {
            heading.setAttribute('data-collapsed', 'false');
            const children = getChildren(heading);
            for (const child of children)
                child.setAttribute('data-collapsed', 'false');
        }

        // get list of elements between this <h2> and next <h2> or <h1>
        // ("children" of the <h2> section)
        function getChildren(heading) {
            return nextUntil(heading, 'h2, h1', exclude);
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get list of elements after a start element up to element matching
        // query
        function nextUntil(element, query, exclude) {
            const elements = [];
            while (element = element.nextElementSibling, element) {
                if (element.matches(query))
                    break;
                if (!element.matches(exclude))
                    elements.push(element);
            }
            return elements;
        }

        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- angle down icon -->

<template class="icon_angle_down">
    <!-- modified from: https://fontawesome.com/icons/angle-down -->
    <svg width="16" height="16" viewBox="0 0 448 512">
        <path
            fill="currentColor"
            d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"
        ></path>
    </svg>
</template>
<!-- tooltips plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when the user hovers or
        // focuses a link to a citation or figure, a tooltip appears with a
        // preview of the reference content, along with arrows to navigate
        // between instances of the same reference in the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'tooltips';

        // default plugin options
        const options = {
            // whether user must click off to close tooltip instead of just
            // un-hovering
            clickClose: 'false',
            // delay (in ms) between opening and closing tooltip
            delay: '100',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            const links = getLinks();
            for (const link of links) {
                // attach hover and focus listeners to link
                link.addEventListener('mouseover', onLinkHover);
                link.addEventListener('mouseleave', onLinkUnhover);
                link.addEventListener('focus', onLinkFocus);
                link.addEventListener('touchend', onLinkTouch);
            }

            // attach mouse, key, and resize listeners to window
            window.addEventListener('mousedown', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('keyup', onKeyUp);
            window.addEventListener('resize', onResize);
        }

        // when link is hovered
        function onLinkHover() {
            // function to open tooltip
            const delayOpenTooltip = function() {
                openTooltip(this);
            }.bind(this);

            // run open function after delay
            this.openTooltipTimer = window.setTimeout(
                delayOpenTooltip,
                options.delay
            );
        }

        // when mouse leaves link
        function onLinkUnhover() {
            // cancel opening tooltip
            window.clearTimeout(this.openTooltipTimer);

            // don't close on unhover if option specifies
            if (options.clickClose === 'true')
                return;

            // function to close tooltip
            const delayCloseTooltip = function() {
                // if tooltip open and if mouse isn't over tooltip, close
                const tooltip = document.getElementById('tooltip');
                if (tooltip && !tooltip.matches(':hover'))
                    closeTooltip();
            };

            // run close function after delay
            this.closeTooltipTimer = window.setTimeout(
                delayCloseTooltip,
                options.delay
            );
        }

        // when link is focused (tabbed to)
        function onLinkFocus(event) {
            openTooltip(this);
        }

        // when link is touched on touch screen
        function onLinkTouch(event) {
            // attempt to force hover state on first tap always, and trigger
            // regular link click (and navigation) on second tap
            if (event.target === document.activeElement)
                event.target.click();
            else {
                document.activeElement.blur();
                event.target.focus();
            }
            if (event.cancelable)
                event.preventDefault();
            event.stopPropagation();
            return false;
        }

        // when mouse is clicked anywhere in window
        function onClick(event) {
            closeTooltip();
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            switch (event.key) {
                // trigger click of prev button
                case 'ArrowLeft':
                    const prevButton = document.getElementById(
                        'tooltip_prev_button'
                    );
                    if (prevButton)
                        prevButton.click();
                    break;
                // trigger click of next button
                case 'ArrowRight':
                    const nextButton = document.getElementById(
                        'tooltip_next_button'
                    );
                    if (nextButton)
                        nextButton.click();
                    break;
                // close on esc
                case 'Escape':
                    closeTooltip();
                    break;
            }
        }

        // when window is resized or zoomed
        function onResize() {
            closeTooltip();
        }

        // get all links of types we wish to handle
        function getLinks() {
            const queries = [];
            // exclude buttons, anchor links, toc links, etc
            const exclude =
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            queries.push('a[href^="#ref-"]' + exclude); // citation links
            queries.push('a[href^="#fig:"]' + exclude); // figure links
            const query = queries.join(', ');
            return document.querySelectorAll(query);
        }

        // get links with same target, get index of link in set, get total
        // same links
        function getSameLinks(link) {
            const sameLinks = [];
            const links = getLinks();
            for (const otherLink of links) {
                if (
                    otherLink.getAttribute('href') === link.getAttribute('href')
                )
                    sameLinks.push(otherLink);
            }

            return {
                elements: sameLinks,
                index: sameLinks.indexOf(link),
                total: sameLinks.length
            };
        }

        // open tooltip
        function openTooltip(link) {
            // delete tooltip if it exists, start fresh
            closeTooltip();

            // make tooltip element
            const tooltip = makeTooltip(link);

            // if source couldn't be found and tooltip not made, exit
            if (!tooltip)
                return;

            // make navbar elements
            const navBar = makeNavBar(link);
            if (navBar)
                tooltip.firstElementChild.appendChild(navBar);

            // attach tooltip to page
            document.body.appendChild(tooltip);

            // position tooltip
            const position = function() {
                positionTooltip(link);
            };
            position();

            // if tooltip contains images, position again after they've loaded
            const imgs = tooltip.querySelectorAll('img');
            for (const img of imgs)
                img.addEventListener('load', position);
        }

        // close (delete) tooltip
        function closeTooltip() {
            const tooltip = document.getElementById('tooltip');
            if (tooltip)
                tooltip.remove();
        }

        // make tooltip
        function makeTooltip(link) {
            // get target element that link points to
            const source = getSource(link);

            // if source can't be found, exit
            if (!source)
                return;

            // create new tooltip
            const tooltip = document.createElement('div');
            tooltip.id = 'tooltip';
            const tooltipContent = document.createElement('div');
            tooltipContent.id = 'tooltip_content';
            tooltip.appendChild(tooltipContent);

            // make copy of source node and put in tooltip
            const sourceCopy = makeCopy(source);
            tooltipContent.appendChild(sourceCopy);

            // attach mouse event listeners
            tooltip.addEventListener('click', onTooltipClick);
            tooltip.addEventListener('mousedown', onTooltipClick);
            tooltip.addEventListener('touchstart', onTooltipClick);
            tooltip.addEventListener('mouseleave', onTooltipUnhover);

            // (for interaction with lightbox plugin)
            // transfer click on tooltip copied img to original img
            const sourceImg = source.querySelector('img');
            const sourceCopyImg = sourceCopy.querySelector('img');
            if (sourceImg && sourceCopyImg) {
                const clickImg = function() {
                    sourceImg.click();
                    closeTooltip();
                };
                sourceCopyImg.addEventListener('click', clickImg);
            }

            return tooltip;
        }

        // make carbon copy of html dom element
        function makeCopy(source) {
            const sourceCopy = source.cloneNode(true);

            // delete elements marked with ignore (eg anchor and jump buttons)
            const deleteFromCopy = sourceCopy.querySelectorAll(
                '[data-ignore="true"]'
            );
            for (const element of deleteFromCopy)
                element.remove();

            // delete certain element attributes
            const attributes = [
                'id',
                'data-collapsed',
                'data-selected',
                'data-highlighted',
                'data-glow'
            ];
            for (const attribute of attributes) {
                sourceCopy.removeAttribute(attribute);
                const elements = sourceCopy.querySelectorAll(
                    '[' + attribute + ']'
                );
                for (const element of elements)
                    element.removeAttribute(attribute);
            }

            return sourceCopy;
        }

        // when tooltip is clicked
        function onTooltipClick(event) {
            // when user clicks on tooltip, stop click from transferring
            // outside of tooltip (eg, click off to close tooltip, or eg click
            // off to unhighlight same refs)
            event.stopPropagation();
        }

        // when tooltip is unhovered
        function onTooltipUnhover(event) {
            if (options.clickClose === 'true')
                return;

            // make sure new mouse/touch/focus no longer over tooltip or any
            // element within it
            const tooltip = document.getElementById('tooltip');
            if (!tooltip)
                return;
            if (this.contains(event.relatedTarget))
                return;

            closeTooltip();
        }

        // make nav bar to go betwen prev/next instances of same reference
        function makeNavBar(link) {
            // find other links to the same source
            const sameLinks = getSameLinks(link);

            // don't show nav bar when singular reference
            if (sameLinks.total <= 1)
                return;

            // find prev/next links with same target
            const prevLink = getPrevLink(link, sameLinks);
            const nextLink = getNextLink(link, sameLinks);

            // create nav bar
            const navBar = document.createElement('div');
            navBar.id = 'tooltip_nav_bar';
            const text = sameLinks.index + 1 + ' of ' + sameLinks.total;

            // create nav bar prev/next buttons
            const prevButton = document.createElement('button');
            const nextButton = document.createElement('button');
            prevButton.id = 'tooltip_prev_button';
            nextButton.id = 'tooltip_next_button';
            prevButton.title =
                'Jump to the previous occurence of this item in the document [←]';
            nextButton.title =
                'Jump to the next occurence of this item in the document [→]';
            prevButton.classList.add('icon_button');
            nextButton.classList.add('icon_button');
            prevButton.innerHTML = document.querySelector(
                '.icon_caret_left'
            ).innerHTML;
            nextButton.innerHTML = document.querySelector(
                '.icon_caret_right'
            ).innerHTML;
            navBar.appendChild(prevButton);
            navBar.appendChild(document.createTextNode(text));
            navBar.appendChild(nextButton);

            // attach click listeners to buttons
            prevButton.addEventListener('click', function() {
                onPrevNextClick(link, prevLink);
            });
            nextButton.addEventListener('click', function() {
                onPrevNextClick(link, nextLink);
            });

            return navBar;
        }

        // get previous link with same target
        function getPrevLink(link, sameLinks) {
            if (!sameLinks)
                sameLinks = getSameLinks(link);
            // wrap index to other side if < 1
            let index;
            if (sameLinks.index - 1 >= 0)
                index = sameLinks.index - 1;
            else
                index = sameLinks.total - 1;
            return sameLinks.elements[index];
        }

        // get next link with same target
        function getNextLink(link, sameLinks) {
            if (!sameLinks)
                sameLinks = getSameLinks(link);
            // wrap index to other side if > total
            let index;
            if (sameLinks.index + 1 <= sameLinks.total - 1)
                index = sameLinks.index + 1;
            else
                index = 0;
            return sameLinks.elements[index];
        }

        // get element that is target of link or url hash
        function getSource(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            // if ref or figure, modify target to get expected element
            if (id.indexOf('ref-') === 0)
                target = target.querySelector('p');
            else if (id.indexOf('fig:') === 0)
                target = target.querySelector('figure');

            return target;
        }

        // when prev/next arrow button is clicked
        function onPrevNextClick(link, prevNextLink) {
            if (link && prevNextLink)
                goToElement(prevNextLink, window.innerHeight * 0.5);
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // determine position to place tooltip based on link position in
        // viewport and tooltip size
        function positionTooltip(link, left, top) {
            const tooltipElement = document.getElementById('tooltip');
            if (!tooltipElement)
                return;

            // get convenient vars for position/dimensions of
            // link/tooltip/page/view
            link = getRectInPage(link);
            const tooltip = getRectInPage(tooltipElement);
            const view = getRectInPage();

            // horizontal positioning
            if (left)
                // use explicit value
                left = left;
            else if (link.left + tooltip.width < view.right)
                // fit tooltip to right of link
                left = link.left;
            else if (link.right - tooltip.width > view.left)
                // fit tooltip to left of link
                left = link.right - tooltip.width;
            // center tooltip in view
            else
                left = (view.right - view.left) / 2 - tooltip.width / 2;

            // vertical positioning
            if (top)
                // use explicit value
                top = top;
            else if (link.top - tooltip.height > view.top)
                // fit tooltip above link
                top = link.top - tooltip.height;
            else if (link.bottom + tooltip.height < view.bottom)
                // fit tooltip below link
                top = link.bottom;
            else {
                // center tooltip in view
                top = view.top + view.height / 2 - tooltip.height / 2;
                // nudge off of link to left/right if possible
                if (link.right + tooltip.width < view.right)
                    left = link.right;
                else if (link.left - tooltip.width > view.left)
                    left = link.left - tooltip.width;
            }

            tooltipElement.style.left = left + 'px';
            tooltipElement.style.top = top + 'px';
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get position of element relative to page
        function getRectInPage(element) {
            const rect = getRectInView(element);
            const body = getRectInView(document.body);

            const newRect = {};
            newRect.left = rect.left - body.left;
            newRect.top = rect.top - body.top;
            newRect.right = rect.right - body.left;
            newRect.bottom = rect.bottom - body.top;
            newRect.width = rect.width;
            newRect.height = rect.height;

            return newRect;
        }

        // (for interaction with accordion plugin)
        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // (for interaction with accordion plugin)
        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // (for interaction with accordion plugin)
        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
    <!-- modified from: https://fontawesome.com/icons/caret-left -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
        ></path>
    </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
    <!-- modified from: https://fontawesome.com/icons/caret-right -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
        ></path>
    </svg>
</template>
<!-- jump to first plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin adds a button next to each reference entry,
        // figure, and table that jumps the page to the first occurrence of a
        // link to that item in the manuscript.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'jumpToFirst';

        // default plugin options
        const options = {
            // whether to add buttons next to reference entries
            references: 'true',
            // whether to add buttons next to figures
            figures: 'true',
            // whether to add buttons next to tables
            tables: 'true',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            if (options.references !== 'false')
                makeReferenceButtons();
            if (options.figures !== 'false')
                makeFigureButtons();
            if (options.tables !== 'false')
                makeTableButtons();
        }

        // when jump button clicked
        function onButtonClick() {
            const first = getFirstOccurrence(this.dataset.id);
            if (!first)
                return;

            // update url hash so navigating "back" in history will return
            // user to jump button
            window.location.hash = this.dataset.id;
            // scroll to link
            window.setTimeout(function() {
                goToElement(first, window.innerHeight * 0.5);
            }, 0);
        }

        // get first occurence of link to item in document
        function getFirstOccurrence(id) {
            let query = 'a';
            query += '[href="#' + id + '"]';
            // exclude buttons, anchor links, toc links, etc
            query +=
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            return document.querySelector(query);
        }

        // add button next to each reference entry
        function makeReferenceButtons() {
            const references = document.querySelectorAll('div[id^="ref-"]');
            for (const reference of references) {
                // get reference id and element to add button to
                const id = reference.id;
                const container = reference.firstElementChild;
                const first = getFirstOccurrence(id);

                // if can't find link to reference, ignore
                if (!first)
                    continue;

                // make jump button
                let button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this reference in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.innerHTML = button.outerHTML + container.innerHTML;
                button = container.firstElementChild;
                button.addEventListener('click', onButtonClick);
            }
        }

        // add button next to each figure
        function makeFigureButtons() {
            const figures = document.querySelectorAll('[id^="fig:"]');
            for (const figure of figures) {
                // get figure id and element to add button to
                const id = figure.id;
                const container = figure.querySelector('figcaption') || figure;
                const first = getFirstOccurrence(id);

                // if can't find link to figure, ignore
                if (!first)
                    continue;

                // make jump button
                const button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this figure in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.insertBefore(button, container.firstElementChild);
                button.addEventListener('click', onButtonClick);
            }
        }

        // add button next to each figure
        function makeTableButtons() {
            const tables = document.querySelectorAll('[id^="tbl:"]');
            for (const table of tables) {
                // get ref id and element to add button to
                const id = table.id;
                const container = table.querySelector('caption') || table;
                const first = getFirstOccurrence(id);

                // if can't find link to table, ignore
                if (!first)
                    continue;

                // make jump button
                const button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this table in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.insertBefore(button, container.firstElementChild);
                button.addEventListener('click', onButtonClick);
            }
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // (for interaction with accordion plugin)
        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- angle double up icon -->

<template class="icon_angle_double_up">
    <!-- modified from: https://fontawesome.com/icons/angle-double-up -->
    <svg width="16" height="16" viewBox="0 0 320 512">
        <path
            fill="currentColor"
            d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"
        ></path>
    </svg>
</template>
<!-- link highlight plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when a user hovers or
        // focuses a link, other links that have the same target will be
        // highlighted. It also makes it such that when clicking a link, the
        // target of the link (eg reference, figure, table) is briefly
        // highlighted.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'linkHighlight';

        // default plugin options
        const options = {
            // whether to also highlight links that go to external urls
            externalLinks: 'false',
            // whether user must click off to unhighlight instead of just
            // un-hovering
            clickUnhighlight: 'false',
            // whether to also highlight links that are unique
            highlightUnique: 'true',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            const links = getLinks();
            for (const link of links) {
                // attach mouse and focus listeners to link
                link.addEventListener('mouseenter', onLinkFocus);
                link.addEventListener('focus', onLinkFocus);
                link.addEventListener('mouseleave', onLinkUnhover);
            }

            // attach click and hash change listeners to window
            window.addEventListener('click', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('hashchange', onHashChange);

            // run hash change on window load in case user has navigated
            // directly to hash
            onHashChange();
        }

        // when link is focused (tabbed to) or hovered
        function onLinkFocus() {
            highlight(this);
        }

        // when link is unhovered
        function onLinkUnhover() {
            if (options.clickUnhighlight !== 'true')
                unhighlightAll();
        }

        // when the mouse is clicked anywhere in window
        function onClick(event) {
            unhighlightAll();
        }

        // when hash (eg manuscript.html#introduction) changes
        function onHashChange() {
            const target = getHashTarget();
            if (target)
                glowElement(target);
        }

        // get element that is target of link or url hash
        function getHashTarget(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            return target;
        }

        // start glow sequence on an element
        function glowElement(element) {
            const startGlow = function() {
                onGlowEnd();
                element.dataset.glow = 'true';
                element.addEventListener('animationend', onGlowEnd);
            };
            const onGlowEnd = function() {
                element.removeAttribute('data-glow');
                element.removeEventListener('animationend', onGlowEnd);
            };
            startGlow();
        }

        // highlight link and all others with same target
        function highlight(link) {
            // force unhighlight all to start fresh
            unhighlightAll();

            // get links with same target
            if (!link)
                return;
            const sameLinks = getSameLinks(link);

            // if link unique and option is off, exit and don't highlight
            if (sameLinks.length <= 1 && options.highlightUnique !== 'true')
                return;

            // highlight all same links, and "select" (special highlight) this
            // one
            for (const sameLink of sameLinks) {
                if (sameLink === link)
                    sameLink.setAttribute('data-selected', 'true');
                else
                    sameLink.setAttribute('data-highlighted', 'true');
            }
        }

        // unhighlight all links
        function unhighlightAll() {
            const links = getLinks();
            for (const link of links) {
                link.setAttribute('data-selected', 'false');
                link.setAttribute('data-highlighted', 'false');
            }
        }

        // get links with same target
        function getSameLinks(link) {
            const results = [];
            const links = getLinks();
            for (const otherLink of links) {
                if (
                    otherLink.getAttribute('href') === link.getAttribute('href')
                )
                    results.push(otherLink);
            }
            return results;
        }

        // get all links of types we wish to handle
        function getLinks() {
            let query = 'a';
            if (options.externalLinks !== 'true')
                query += '[href^="#"]';
            // exclude buttons, anchor links, toc links, etc
            query +=
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            return document.querySelectorAll(query);
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>
<!-- table of contents plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin provides a "table of contents" (toc) panel on
        // the side of the document that allows the user to conveniently
        // navigate between sections of the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'tableOfContents';

        // default plugin options
        const options = {
            // which types of elements to add links for, in
            // "document.querySelector" format
            typesQuery: 'h1, h2, h3',
            // whether default behavior is to be closed ('false'), open
            // ('true'), or only open when screen wide enough to fit panel
            // ('auto'). note: still always starts closed when page loads.
            open: 'auto',
            // if list item is more than this many characters, text will be
            // truncated
            charLimit: '50',
            // whether or not to show bullets next to each toc item
            bullets: 'false',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // make toc panel and populate with entries (links to document
            // sections)
            const panel = makePanel();
            if (!panel)
                return;
            makeEntries(panel);
            document.body.insertBefore(panel, document.body.firstChild);

            closePanel();

            // attach click, scroll, and hash change listeners to window
            window.addEventListener('click', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('scroll', onScroll);
            window.addEventListener('hashchange', onScroll);
            window.addEventListener('keyup', onKeyUp);
            onScroll();

            // add class to push document body down out of way of toc button
            document.body.classList.add('toc_body_nudge');
        }

        // determine if screen wide enough to fit toc panel
        function isSmallScreen() {
            // in default theme:
            // 816px = 8.5in = width of "page" (<body>) element
            // 260px = min width of toc panel (*2 for both sides of <body>)
            return window.innerWidth < 816 + 260 * 2;
        }

        // open/close panel based on option and screen size
        function openOrClosePanel() {
            if (
                options.open === 'true' ||
                (options.open === 'auto' && !isSmallScreen())
            )
                openPanel();
            else
                closePanel();
        }

        // when mouse is clicked anywhere in window
        function onClick() {
            const panel = document.getElementById('toc_panel');
            if (!panel)
                return;

            if (panel.dataset.open === 'true')
                openOrClosePanel();
        }

        // when window is scrolled or hash changed
        function onScroll() {
            highlightViewed();
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            // close on esc
            if (event.key === 'Escape')
                closePanel();
        }

        // find entry of currently viewed document section in toc and highlight
        function highlightViewed() {
            const firstId = getFirstInView(options.typesQuery);

            // get toc entries (links), unhighlight all, then highlight viewed
            const list = document.getElementById('toc_list');
            if (!firstId || !list)
                return;
            const links = list.querySelectorAll('a');
            for (const link of links)
                link.dataset.viewing = 'false';
            const link = list.querySelector('a[href="#' + firstId + '"]');
            if (!link)
                return;
            link.dataset.viewing = 'true';
        }

        // get first or previous toc listed element in top half of view
        function getFirstInView(query) {
            // get all elements matching query and with id
            const elements = document.querySelectorAll(query);
            const elementsWithIds = [];
            for (const element of elements) {
                if (element.id)
                    elementsWithIds.push(element);
            }


            // get first or previous element in top half of view
            for (let i = 0; i < elementsWithIds.length; i++) {
                const element = elementsWithIds[i];
                const prevElement = elementsWithIds[Math.max(0, i - 1)];
                if (element.getBoundingClientRect().top >= 0) {
                    if (
                        element.getBoundingClientRect().top <
                        window.innerHeight / 2
                    )
                        return element.id;
                    else
                        return prevElement.id;
                }
            }
        }

        // make panel
        function makePanel() {
            // create panel
            const panel = document.createElement('div');
            panel.id = 'toc_panel';
            if (options.bullets === 'true')
                panel.dataset.bullets = 'true';

            // create header
            const header = document.createElement('div');
            header.id = 'toc_header';

            // create toc button
            const button = document.createElement('button');
            button.id = 'toc_button';
            button.innerHTML = document.querySelector(
                '.icon_th_list'
            ).innerHTML;
            button.classList.add('icon_button');

            // create header text
            const text = document.createElement('h3');
            text.innerHTML = 'Table of Contents';

            // create container for toc list
            const list = document.createElement('div');
            list.id = 'toc_list';

            // attach click listeners
            panel.addEventListener('click', onPanelClick);
            header.addEventListener('click', onHeaderClick);
            button.addEventListener('click', onButtonClick);

            // attach elements
            header.appendChild(button);
            header.appendChild(text);
            panel.appendChild(header);
            panel.appendChild(list);

            return panel;
        }

        // create toc entries (links) to each element of the specified types
        function makeEntries(panel) {
            const elements = document.querySelectorAll(options.typesQuery);
            for (const element of elements) {
                // do not add link if element doesn't have assigned id
                if (!element.id)
                    continue;

                // create link/list item
                const link = document.createElement('a');
                link.classList.add('toc_link');
                switch (element.tagName.toLowerCase()) {
                    case 'h1':
                        link.dataset.level = '1';
                        break;
                    case 'h2':
                        link.dataset.level = '2';
                        break;
                    case 'h3':
                        link.dataset.level = '3';
                        break;
                    case 'h4':
                        link.dataset.level = '4';
                        break;
                }
                link.title = element.innerText;
                let text = element.innerText;
                if (text.length > options.charLimit)
                    text = text.slice(0, options.charLimit) + '...';
                link.innerHTML = text;
                link.href = '#' + element.id;
                link.addEventListener('click', onLinkClick);

                // attach link
                panel.querySelector('#toc_list').appendChild(link);
            }
        }

        // when panel is clicked
        function onPanelClick(event) {
            // stop click from propagating to window/document and closing panel
            event.stopPropagation();
        }

        // when header itself is clicked
        function onHeaderClick(event) {
            togglePanel();
        }

        // when button is clicked
        function onButtonClick(event) {
            togglePanel();
            // stop header underneath button from also being clicked
            event.stopPropagation();
        }

        // when link is clicked
        function onLinkClick() {
            openOrClosePanel();
        }

        // open panel if closed, close if opened
        function togglePanel() {
            const panel = document.getElementById('toc_panel');
            if (!panel)
                return;

            if (panel.dataset.open === 'true')
                closePanel();
            else
                openPanel();
        }

        // open panel
        function openPanel() {
            const panel = document.getElementById('toc_panel');
            if (panel)
                panel.dataset.open = 'true';
        }

        // close panel
        function closePanel() {
            const panel = document.getElementById('toc_panel');
            if (panel)
                panel.dataset.open = 'false';
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- th list icon -->

<template class="icon_th_list">
    <!-- modified from: https://fontawesome.com/icons/th-list -->
    <svg width="16" height="16" viewBox="0 0 512 512" tabindex="-1">
        <path
            fill="currentColor"
            d="M96 96c0 26.51-21.49 48-48 48S0 122.51 0 96s21.49-48 48-48 48 21.49 48 48zM48 208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm0 160c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm96-236h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
            tabindex="-1"
        ></path>
    </svg>
</template>
<!-- lightbox plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when a user clicks on an
        // image, the image fills the screen and the user can pan/drag/zoom
        // the image and navigate between other images in the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'lightbox';

        // default plugin options
        const options = {
            // list of possible zoom/scale factors
            zoomSteps:
                '0.1, 0.25, 0.333333, 0.5, 0.666666, 0.75, 1,' +
                '1.25, 1.5, 1.75, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8',
            // whether to fit image to view ('fit'), display at 100% and shrink
            // if necessary ('shrink'), or always display at 100% ('100')
            defaultZoom: 'fit',
            // whether to zoom in/out toward center of view ('true') or mouse
            // ('false')
            centerZoom: 'false',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // run through each <img> element
            const imgs = document.querySelectorAll('figure > img');
            let count = 1;
            for (const img of imgs) {
                img.classList.add('lightbox_document_img');
                img.dataset.number = count;
                img.dataset.total = imgs.length;
                img.addEventListener('click', openLightbox);
                count++;
            }

            // attach mouse and key listeners to window
            window.addEventListener('mousemove', onWindowMouseMove);
            window.addEventListener('keyup', onKeyUp);
        }

        // when mouse is moved anywhere in window
        function onWindowMouseMove(event) {
            window.mouseX = event.clientX;
            window.mouseY = event.clientY;
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            switch (event.key) {
                // trigger click of prev button
                case 'ArrowLeft':
                    const prevButton = document.getElementById(
                        'lightbox_prev_button'
                    );
                    if (prevButton)
                        prevButton.click();
                    break;
                // trigger click of next button
                case 'ArrowRight':
                    const nextButton = document.getElementById(
                        'lightbox_next_button'
                    );
                    if (nextButton)
                        nextButton.click();
                    break;
                // close on esc
                case 'Escape':
                    closeLightbox();
                    break;
            }
        }

        // open lightbox
        function openLightbox() {
            const lightbox = makeLightbox(this);
            if (!lightbox)
                return;

            blurBody(lightbox);
            document.body.appendChild(lightbox);
        }

        // make lightbox
        function makeLightbox(img) {
            // delete lightbox if it exists, start fresh
            closeLightbox();

            // create screen overlay containing lightbox
            const overlay = document.createElement('div');
            overlay.id = 'lightbox_overlay';

            // create image info boxes
            const numberInfo = document.createElement('div');
            const zoomInfo = document.createElement('div');
            numberInfo.id = 'lightbox_number_info';
            zoomInfo.id = 'lightbox_zoom_info';

            // create container for image
            const imageContainer = document.createElement('div');
            imageContainer.id = 'lightbox_image_container';
            const lightboxImg = makeLightboxImg(
                img,
                imageContainer,
                numberInfo,
                zoomInfo
            );
            imageContainer.appendChild(lightboxImg);

            // create bottom container for caption and navigation buttons
            const bottomContainer = document.createElement('div');
            bottomContainer.id = 'lightbox_bottom_container';
            const caption = makeCaption(img);
            const prevButton = makePrevButton(img);
            const nextButton = makeNextButton(img);
            bottomContainer.appendChild(prevButton);
            bottomContainer.appendChild(caption);
            bottomContainer.appendChild(nextButton);

            // attach top middle and bottom to overlay
            overlay.appendChild(numberInfo);
            overlay.appendChild(zoomInfo);
            overlay.appendChild(imageContainer);
            overlay.appendChild(bottomContainer);

            return overlay;
        }

        // make <img> object that is intuitively draggable and zoomable
        function makeLightboxImg(
            sourceImg,
            container,
            numberInfoBox,
            zoomInfoBox
        ) {
            // create copy of source <img>
            const img = sourceImg.cloneNode(true);
            img.classList.remove('lightbox_document_img');
            img.removeAttribute('id');
            img.removeAttribute('width');
            img.removeAttribute('height');
            img.style.position = 'unset';
            img.style.margin = '0';
            img.style.padding = '0';
            img.style.width = '';
            img.style.height = '';
            img.style.minWidth = '';
            img.style.minHeight = '';
            img.style.maxWidth = '';
            img.style.maxHeight = '';
            img.id = 'lightbox_img';

            // build sorted list of unique zoomSteps, always including a 100%
            let zoomSteps = [];
            const optionsZooms = options.zoomSteps.split(/[^0-9.]/);
            for (const optionZoom of optionsZooms) {
                const newZoom = parseFloat(optionZoom);
                if (newZoom && !zoomSteps.includes(newZoom))
                    zoomSteps.push(newZoom);
            }
            if (!zoomSteps.includes(1))
                zoomSteps.push(1);
            zoomSteps = zoomSteps.sort(function sortNumber(a, b) {
                return a - b;
            });

            // <img> object property variables
            let zoom = 1;
            let translateX = 0;
            let translateY = 0;
            let clickMouseX = undefined;
            let clickMouseY = undefined;
            let clickTranslateX = undefined;
            let clickTranslateY = undefined;

            updateNumberInfo();

            // update image numbers displayed in info box
            function updateNumberInfo() {
                numberInfoBox.innerHTML =
                    sourceImg.dataset.number + ' of ' + sourceImg.dataset.total;
            }

            // update zoom displayed in info box
            function updateZoomInfo() {
                let zoomInfo = zoom * 100;
                if (!Number.isInteger(zoomInfo))
                    zoomInfo = zoomInfo.toFixed(2);
                zoomInfoBox.innerHTML = zoomInfo + '%';
            }

            // move to closest zoom step above current zoom
            const zoomIn = function() {
                for (const zoomStep of zoomSteps) {
                    if (zoomStep > zoom) {
                        zoom = zoomStep;
                        break;
                    }
                }
                updateTransform();
            };

            // move to closest zoom step above current zoom
            const zoomOut = function() {
                zoomSteps.reverse();
                for (const zoomStep of zoomSteps) {
                    if (zoomStep < zoom) {
                        zoom = zoomStep;
                        break;
                    }
                }
                zoomSteps.reverse();

                updateTransform();
            };

            // update display of <img> based on scale/translate properties
            const updateTransform = function() {
                // set transform
                img.style.transform =
                    'translate(' +
                    (translateX || 0) +
                    'px,' +
                    (translateY || 0) +
                    'px) scale(' +
                    (zoom || 1) +
                    ')';

                // get new width/height after scale
                const rect = img.getBoundingClientRect();
                // limit translate
                translateX = Math.max(translateX, -rect.width / 2);
                translateX = Math.min(translateX, rect.width / 2);
                translateY = Math.max(translateY, -rect.height / 2);
                translateY = Math.min(translateY, rect.height / 2);

                // set transform
                img.style.transform =
                    'translate(' +
                    (translateX || 0) +
                    'px,' +
                    (translateY || 0) +
                    'px) scale(' +
                    (zoom || 1) +
                    ')';

                updateZoomInfo();
            };

            // fit <img> to container
            const fit = function() {
                // no x/y offset, 100% zoom by default
                translateX = 0;
                translateY = 0;
                zoom = 1;

                // widths of <img> and container
                const imgWidth = img.naturalWidth;
                const imgHeight = img.naturalHeight;
                const containerWidth = parseFloat(
                    window.getComputedStyle(container).width
                );
                const containerHeight = parseFloat(
                    window.getComputedStyle(container).height
                );

                // how much zooming is needed to fit <img> to container
                const xRatio = imgWidth / containerWidth;
                const yRatio = imgHeight / containerHeight;
                const maxRatio = Math.max(xRatio, yRatio);
                const newZoom = 1 / maxRatio;

                // fit <img> to container according to option
                if (options.defaultZoom === 'shrink') {
                    if (maxRatio > 1)
                        zoom = newZoom;
                } else if (options.defaultZoom === 'fit')
                    zoom = newZoom;

                updateTransform();
            };

            // when mouse wheel is rolled anywhere in container
            const onContainerWheel = function(event) {
                if (!event)
                    return;

                // let ctrl + mouse wheel to zoom behave as normal
                if (event.ctrlKey)
                    return;

                // prevent normal scroll behavior
                event.preventDefault();
                event.stopPropagation();

                // point around which to scale img
                const viewRect = container.getBoundingClientRect();
                const viewX = (viewRect.left + viewRect.right) / 2;
                const viewY = (viewRect.top + viewRect.bottom) / 2;
                const originX = options.centerZoom === 'true' ? viewX : mouseX;
                const originY = options.centerZoom === 'true' ? viewY : mouseY;

                // get point on image under origin
                const oldRect = img.getBoundingClientRect();
                const oldPercentX = (originX - oldRect.left) / oldRect.width;
                const oldPercentY = (originY - oldRect.top) / oldRect.height;

                // increment/decrement zoom
                if (event.deltaY < 0)
                    zoomIn();
                if (event.deltaY > 0)
                    zoomOut();

                // get offset between previous image point and origin
                const newRect = img.getBoundingClientRect();
                const offsetX =
                    originX - (newRect.left + newRect.width * oldPercentX);
                const offsetY =
                    originY - (newRect.top + newRect.height * oldPercentY);

                // translate image to keep image point under origin
                translateX += offsetX;
                translateY += offsetY;

                // perform translate
                updateTransform();
            };

            // when container is clicked
            function onContainerClick(event) {
                // if container itself is target of click, and not other
                // element above it
                if (event.target === this)
                    closeLightbox();
            }

            // when mouse button is pressed on image
            const onImageMouseDown = function(event) {
                // store original mouse position relative to image
                clickMouseX = window.mouseX;
                clickMouseY = window.mouseY;
                clickTranslateX = translateX;
                clickTranslateY = translateY;
                event.stopPropagation();
                event.preventDefault();
            };

            // when mouse button is released anywhere in window
            const onWindowMouseUp = function(event) {
                // reset original mouse position
                clickMouseX = undefined;
                clickMouseY = undefined;
                clickTranslateX = undefined;
                clickTranslateY = undefined;

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('mouseup', onWindowMouseUp);
            };

            // when mouse is moved anywhere in window
            const onWindowMouseMove = function(event) {
                if (
                    clickMouseX === undefined ||
                    clickMouseY === undefined ||
                    clickTranslateX === undefined ||
                    clickTranslateY === undefined
                )
                    return;

                // offset image based on original and current mouse position
                translateX = clickTranslateX + window.mouseX - clickMouseX;
                translateY = clickTranslateY + window.mouseY - clickMouseY;
                updateTransform();
                event.preventDefault();

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('mousemove', onWindowMouseMove);
            };

            // when window is resized
            const onWindowResize = function(event) {
                fit();

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('resize', onWindowResize);
            };

            // attach the necessary event listeners
            img.addEventListener('dblclick', fit);
            img.addEventListener('mousedown', onImageMouseDown);
            container.addEventListener('wheel', onContainerWheel);
            container.addEventListener('mousedown', onContainerClick);
            container.addEventListener('touchstart', onContainerClick);
            window.addEventListener('mouseup', onWindowMouseUp);
            window.addEventListener('mousemove', onWindowMouseMove);
            window.addEventListener('resize', onWindowResize);

            // run fit() after lightbox atttached to document and <img> Loaded
            // so needed container and img dimensions available
            img.addEventListener('load', fit);

            return img;
        }

        // make caption
        function makeCaption(img) {
            const caption = document.createElement('div');
            caption.id = 'lightbox_caption';
            const captionSource = img.nextElementSibling;
            if (captionSource.tagName.toLowerCase() === 'figcaption') {
                const captionCopy = makeCopy(captionSource);
                caption.innerHTML = captionCopy.innerHTML;
            }

            caption.addEventListener('touchstart', function(event) {
                event.stopPropagation();
            });

            return caption;
        }

        // make carbon copy of html dom element
        function makeCopy(source) {
            const sourceCopy = source.cloneNode(true);

            // delete elements marked with ignore (eg anchor and jump buttons)
            const deleteFromCopy = sourceCopy.querySelectorAll(
                '[data-ignore="true"]'
            );
            for (const element of deleteFromCopy)
                element.remove();

            // delete certain element attributes
            const attributes = [
                'id',
                'data-collapsed',
                'data-selected',
                'data-highlighted',
                'data-glow'
            ];
            for (const attribute of attributes) {
                sourceCopy.removeAttribute(attribute);
                const elements = sourceCopy.querySelectorAll(
                    '[' + attribute + ']'
                );
                for (const element of elements)
                    element.removeAttribute(attribute);
            }

            return sourceCopy;
        }

        // make button to jump to previous image in document
        function makePrevButton(img) {
            const prevButton = document.createElement('button');
            prevButton.id = 'lightbox_prev_button';
            prevButton.title = 'Jump to the previous image in the document [←]';
            prevButton.classList.add('icon_button', 'lightbox_button');
            prevButton.innerHTML = document.querySelector(
                '.icon_caret_left'
            ).innerHTML;

            // attach click listeners to button
            prevButton.addEventListener('click', function() {
                getPrevImg(img).click();
            });

            return prevButton;
        }

        // make button to jump to next image in document
        function makeNextButton(img) {
            const nextButton = document.createElement('button');
            nextButton.id = 'lightbox_next_button';
            nextButton.title = 'Jump to the next image in the document [→]';
            nextButton.classList.add('icon_button', 'lightbox_button');
            nextButton.innerHTML = document.querySelector(
                '.icon_caret_right'
            ).innerHTML;

            // attach click listeners to button
            nextButton.addEventListener('click', function() {
                getNextImg(img).click();
            });

            return nextButton;
        }

        // get previous image in document
        function getPrevImg(img) {
            const imgs = document.querySelectorAll('.lightbox_document_img');

            // find index of provided img
            let index;
            for (index = 0; index < imgs.length; index++) {
                if (imgs[index] === img)
                    break;
            }


            // wrap index to other side if < 1
            if (index - 1 >= 0)
                index--;
            else
                index = imgs.length - 1;
            return imgs[index];
        }

        // get next image in document
        function getNextImg(img) {
            const imgs = document.querySelectorAll('.lightbox_document_img');

            // find index of provided img
            let index;
            for (index = 0; index < imgs.length; index++) {
                if (imgs[index] === img)
                    break;
            }


            // wrap index to other side if > total
            if (index + 1 <= imgs.length - 1)
                index++;
            else
                index = 0;
            return imgs[index];
        }

        // close lightbox
        function closeLightbox() {
            focusBody();

            const lightbox = document.getElementById('lightbox_overlay');
            if (lightbox)
                lightbox.remove();
        }

        // make all elements behind lightbox non-focusable
        function blurBody(overlay) {
            const all = document.querySelectorAll('*');
            for (const element of all)
                element.tabIndex = -1;
            document.body.classList.add('body_no_scroll');
        }

        // make all elements focusable again
        function focusBody() {
            const all = document.querySelectorAll('*');
            for (const element of all)
                element.removeAttribute('tabIndex');
            document.body.classList.remove('body_no_scroll');
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
    <!-- modified from: https://fontawesome.com/icons/caret-left -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
        ></path>
    </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
    <!-- modified from: https://fontawesome.com/icons/caret-right -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
        ></path>
    </svg>
</template>
<!-- attributes plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin allows arbitrary HTML attributes to be attached
        // to (almost) any element. Place an HTML comment inside or next to the
        // desired element in the format <!-- $attribute="value" -->

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'attributes';

        // default plugin options
        const options = {
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // get list of comments in document
            const comments = findComments();

            for(const comment of comments)
                if (comment.parentElement)
                    addAttributes(
                        comment.parentElement,
                        comment.nodeValue.trim()
                    );
        }

        // add html attributes to specified element based on string of 
        // html attributes and values
        function addAttributes(element, text) {
            // regex's for finding attribute/value pairs in the format of
            // attribute="value" or attribute='value
            const regex2 = /\$([a-zA-Z\-]+)?=\"(.+?)\"/;
            const regex1 = /\$([a-zA-Z\-]+)?=\'(.+?)\'/;

            // loop through attribute/value pairs
            let match;
            while(match = text.match(regex2) || text.match(regex1)) {
                // get attribute and value from regex capture groups
                let attribute = match[1];
                let value = match[2];

                // remove from string
                text = text.substring(match.index + match[0].length);

                if (!attribute || !value)
                    break;

                // set attribute of parent element
                try {
                    element.setAttribute(attribute, value);
                } catch(error) {
                    console.log(error);
                }

                // special case for colspan
                if (attribute === 'colspan')
                    removeTableCells(element, value);
            }
        }

        // get list of comment elements in document
        function findComments() {
            const comments = [];

            // iterate over comment nodes in document
            function acceptNode(node) {
                return NodeFilter.FILTER_ACCEPT;
            }
            const iterator = document.createNodeIterator(
                document.body,
                NodeFilter.SHOW_COMMENT,
                acceptNode
            );
            let node;
            while(node = iterator.nextNode())
                comments.push(node);

            return comments;
        }

        // remove certain number of cells after specified cell
        function removeTableCells(cell, number) {
            number = parseInt(number);
            if (!number)
                return;

            // remove elements
            for(; number > 1; number--) {
                if (cell.nextElementSibling)
                    cell.nextElementSibling.remove();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>
<!-- math plugin configuration -->

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        "CommonHTML": { linebreaks: { automatic: true } },
        "HTML-CSS": { linebreaks: { automatic: true } },
        "SVG": { linebreaks: { automatic: true } },
        "fast-preview": { disabled: true }
    });
</script>

<!-- math plugin -->

<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML'>
    // /////////////////////////
    // DESCRIPTION
    // /////////////////////////

    // This third-party plugin 'MathJax' allows the proper rendering of
    // math/equations written in LaTeX.

    // https://www.mathjax.org/
</script>
<!-- annotations plugin configuration -->

<script>
    window.hypothesisConfig = function() {
        return {
            branding: {
                accentColor: '#2196f3',
                appBackgroundColor: '#f8f8f8',
                ctaBackgroundColor: '#f8f8f8',
                ctaTextColor: '#000000',
                selectionFontFamily: 'Open Sans, Helvetica, sans serif',
                annotationFontFamily: 'Open Sans, Helvetica, sans serif'
            }
        };
    };
</script>

<!-- annotations plugin -->

<script src='https://hypothes.is/embed.js'>
    // /////////////////////////
    // DESCRIPTION
    // /////////////////////////

    // This third-party plugin 'Hypothesis' allows public annotation of the
    // manuscript.

    // https://web.hypothes.is/
</script>
<!-- analytics plugin -->

<!-- copy and paste code from Google Analytics or similar service here -->
</body>
</html>
